<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Core nvTblHandler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f7f7f9;
            color: #333;
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }
        h1, h2, h3 {
            color: #1d72b8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        th {
            background-color: #f4f4f4;
            text-align: left;
        }
        pre {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .example {
            background-color: #e8f4fd;
            border-left: 4px solid #1d72b8;
            padding: 15px;
            margin: 15px 0;
        }
        .architecture {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .architecture img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<h1>Documentation Core - nvTblHandler</h1>

<p>Le cœur de nvTblHandler est conçu autour d'une architecture modulaire basée sur les plugins. Cette documentation détaille son fonctionnement interne et explique comment créer des plugins personnalisés.</p>

<h2>Architecture</h2>
<div class="architecture">
    <h3>Structure du Core</h3>
    <ul>
        <li><strong>Event System</strong> : Gestion des événements entre plugins</li>
        <li><strong>Plugin Manager</strong> : Chargement et gestion des plugins</li>
        <li><strong>DOM Handler</strong> : Manipulation du tableau HTML</li>
        <li><strong>State Manager</strong> : Gestion de l'état du tableau</li>
    </ul>
</div>

<h2>Système d'Événements</h2>
<p>nvTblHandler utilise un système d'événements pour permettre la communication entre les plugins :</p>

<pre><code>// Écoute d'un événement
this.on('event:name', (data) => {
    // Traitement
});

// Déclenchement d'un événement
this.emit('event:name', data);</code></pre>

<h3>Événements Core</h3>
<table>
    <thead>
        <tr>
            <th>Événement</th>
            <th>Données</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>table:init</code></td>
            <td>{ table, config }</td>
            <td>Initialisation du tableau</td>
        </tr>
        <tr>
            <td><code>table:refresh</code></td>
            <td>{ table }</td>
            <td>Rafraîchissement du tableau</td>
        </tr>
        <tr>
            <td><code>table:destroy</code></td>
            <td>{ table }</td>
            <td>Destruction du tableau</td>
        </tr>
        <tr>
            <td><code>plugin:init</code></td>
            <td>{ plugin, config }</td>
            <td>Initialisation d'un plugin</td>
        </tr>
        <tr>
            <td><code>plugin:destroy</code></td>
            <td>{ plugin }</td>
            <td>Destruction d'un plugin</td>
        </tr>
    </tbody>
</table>

<h2>Création d'un Plugin</h2>
<p>Structure de base d'un plugin :</p>

<pre><code>class MyPlugin {
    constructor(table, config) {
        this.table = table;
        this.config = config;
        this.init();
    }

    init() {
        // Initialisation du plugin
        this.table.emit('plugin:init', { plugin: this, config: this.config });
    }

    destroy() {
        // Nettoyage du plugin
        this.table.emit('plugin:destroy', { plugin: this });
    }
}</code></pre>

<h2>API Core</h2>

<h3>Méthodes Principales</h3>
<table>
    <thead>
        <tr>
            <th>Méthode</th>
            <th>Arguments</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>on(event, callback)</code></td>
            <td>string, function</td>
            <td>Écoute un événement</td>
        </tr>
        <tr>
            <td><code>emit(event, data)</code></td>
            <td>string, object</td>
            <td>Déclenche un événement</td>
        </tr>
        <tr>
            <td><code>getPlugin(name)</code></td>
            <td>string</td>
            <td>Récupère une instance de plugin</td>
        </tr>
        <tr>
            <td><code>registerPlugin(name, plugin)</code></td>
            <td>string, class</td>
            <td>Enregistre un nouveau plugin</td>
        </tr>
    </tbody>
</table>

<h3>Méthodes DOM</h3>
<table>
    <thead>
        <tr>
            <th>Méthode</th>
            <th>Arguments</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>getTable()</code></td>
            <td>-</td>
            <td>Récupère l'élément table</td>
        </tr>
        <tr>
            <td><code>getRows()</code></td>
            <td>-</td>
            <td>Récupère toutes les lignes</td>
        </tr>
        <tr>
            <td><code>getCells(row)</code></td>
            <td>HTMLElement</td>
            <td>Récupère les cellules d'une ligne</td>
        </tr>
        <tr>
            <td><code>getHeaders()</code></td>
            <td>-</td>
            <td>Récupère les en-têtes</td>
        </tr>
    </tbody>
</table>

<h2>Exemple de Plugin Personnalisé</h2>
<div class="example">
<pre><code>// Plugin de tri simple
class SortPlugin {
    constructor(table, config) {
        this.table = table;
        this.config = {
            sortAttribute: 'th-sort',
            ...config
        };
        this.init();
    }

    init() {
        const headers = this.table.getHeaders();
        headers.forEach(header => {
            if (header.hasAttribute(this.config.sortAttribute)) {
                header.addEventListener('click', () => this.sort(header));
            }
        });
        
        this.table.emit('plugin:init', { 
            plugin: this, 
            config: this.config 
        });
    }

    sort(header) {
        const columnIndex = header.cellIndex;
        const rows = Array.from(this.table.getRows());
        
        rows.sort((a, b) => {
            const aValue = this.getCellValue(a, columnIndex);
            const bValue = this.getCellValue(b, columnIndex);
            return aValue.localeCompare(bValue);
        });
        
        rows.forEach(row => row.parentNode.appendChild(row));
        
        this.table.emit('sort:complete', { 
            column: header, 
            rows: rows 
        });
    }

    getCellValue(row, index) {
        return row.cells[index].textContent;
    }

    destroy() {
        // Nettoyage des événements
        this.table.emit('plugin:destroy', { plugin: this });
    }
}

// Utilisation
const table = new NvTblHandler({
    tableId: 'monTableau',
    plugins: {
        Sort: {
            sortAttribute: 'th-sort'
        }
    }
});</code></pre>
</div>

<h2>Bonnes Pratiques</h2>
<div class="note">
    <h3>Recommandations pour le Développement de Plugins</h3>
    <ul>
        <li>Toujours utiliser le système d'événements pour la communication</li>
        <li>Nettoyer les événements et les éléments DOM dans la méthode destroy()</li>
        <li>Utiliser la configuration par défaut fusionnée avec la config utilisateur</li>
        <li>Émettre les événements appropriés pour le cycle de vie du plugin</li>
        <li>Documenter les événements et les options de configuration</li>
        <li>Utiliser les méthodes DOM du core plutôt que des sélecteurs directs</li>
    </ul>
</div>

<h2>Cycle de Vie d'un Plugin</h2>
<ol>
    <li><strong>Construction</strong> : Appel du constructeur avec table et config</li>
    <li><strong>Initialisation</strong> : Mise en place des écouteurs et des éléments DOM</li>
    <li><strong>Configuration</strong> : Fusion des options par défaut avec la config utilisateur</li>
    <li><strong>Exécution</strong> : Fonctionnement normal avec émission d'événements</li>
    <li><strong>Destruction</strong> : Nettoyage des ressources lors de la destruction</li>
</ol>

<h2>Débogage</h2>
<p>nvTblHandler inclut des fonctionnalités de débogage activables via l'option debug :</p>

<pre><code>const table = new NvTblHandler({
    tableId: 'monTableau',
    debug: true,
    plugins: {
        // ...
    }
});</code></pre>

<p>En mode debug :</p>
<ul>
    <li>Les événements sont loggués dans la console</li>
    <li>Les erreurs de configuration sont détaillées</li>
    <li>Les avertissements de performance sont affichés</li>
    <li>L'état des plugins est accessible via la console</li>
</ul>

</body>
</html>
