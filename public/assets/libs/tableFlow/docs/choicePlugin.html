<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - ChoicePlugin pour nvTblHandler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f7f7f9;
            color: #333;
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }
        h1, h2, h3 {
            color: #1d72b8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        th {
            background-color: #f4f4f4;
            text-align: left;
        }
        pre {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .example {
            background-color: #e8f4fd;
            border-left: 4px solid #1d72b8;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<h1>Documentation ChoicePlugin - nvTblHandler</h1>

<p>Le plugin <code>ChoicePlugin</code> permet d'ajouter des listes déroulantes (select) dans les cellules d'un tableau, offrant ainsi un choix parmi des valeurs prédéfinies.</p>

<h2>Caractéristiques Principales</h2>
<ul>
    <li>Conversion automatique des cellules en listes déroulantes</li>
    <li>Support des valeurs et libellés personnalisés</li>
    <li>Gestion des états (modifié, lecture seule)</li>
    <li>Validation des valeurs</li>
    <li>Support multilingue</li>
    <li>Événements personnalisables</li>
    <li>Styles CSS configurables</li>
</ul>

<h2>Configuration</h2>
<p>Exemple de configuration du plugin :</p>
<pre><code>const table = new NvTblHandler({
    tableId: 'monTableau',
    plugins: {
        Choice: {
            // Attribut pour marquer les colonnes avec choix
            choiceAttribute: 'th-choice',
            
            // Configuration des choix par colonne
            choices: {
                'status': {
                    values: [
                        { value: '1', label: 'Actif' },
                        { value: '0', label: 'Inactif' }
                    ],
                    defaultValue: '1'
                },
                'priority': {
                    values: [
                        { value: 'high', label: 'Haute' },
                        { value: 'medium', label: 'Moyenne' },
                        { value: 'low', label: 'Basse' }
                    ],
                    defaultValue: 'medium'
                }
            },
            
            // Classes CSS
            cellClass: 'choice-cell',
            modifiedClass: 'modified',
            readOnlyClass: 'readonly',
            
            // Mode debug
            debug: false,
            
            // Événements
            onChange: (columnId, newValue, oldValue, cell) => {
                console.log(`Valeur changée dans ${columnId}: ${oldValue} -> ${newValue}`);
            }
        }
    }
});</code></pre>

<h2>Options de Configuration</h2>
<table>
    <thead>
        <tr>
            <th>Option</th>
            <th>Type</th>
            <th>Description</th>
            <th>Défaut</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>choiceAttribute</code></td>
            <td>string</td>
            <td>Attribut HTML pour identifier les colonnes avec choix</td>
            <td>'th-choice'</td>
        </tr>
        <tr>
            <td><code>choices</code></td>
            <td>object</td>
            <td>Configuration des choix par colonne</td>
            <td>{}</td>
        </tr>
        <tr>
            <td><code>cellClass</code></td>
            <td>string</td>
            <td>Classe CSS pour les cellules avec choix</td>
            <td>'choice-cell'</td>
        </tr>
        <tr>
            <td><code>modifiedClass</code></td>
            <td>string</td>
            <td>Classe CSS pour les cellules modifiées</td>
            <td>'modified'</td>
        </tr>
        <tr>
            <td><code>readOnlyClass</code></td>
            <td>string</td>
            <td>Classe CSS pour les cellules en lecture seule</td>
            <td>'readonly'</td>
        </tr>
        <tr>
            <td><code>debug</code></td>
            <td>boolean</td>
            <td>Active le mode debug</td>
            <td>false</td>
        </tr>
    </tbody>
</table>

<h2>Structure des Choix</h2>
<p>La configuration des choix doit suivre cette structure :</p>
<pre><code>{
    'nomColonne': {
        values: [
            { value: 'valeur1', label: 'Libellé 1' },
            { value: 'valeur2', label: 'Libellé 2' }
        ],
        defaultValue: 'valeur1'
    }
}</code></pre>

<p><strong>Important :</strong> Les choix doivent être un tableau d'objets avec les propriétés <code>value</code> et <code>label</code>. Ne pas utiliser un objet simple pour les valeurs.</p>

<h3>❌ Structure incorrecte :</h3>
<pre><code>{
    'status': {
        values: {
            '1': 'Actif',
            '0': 'Inactif'
        }
    }
}</code></pre>

<h3>✅ Structure correcte :</h3>
<pre><code>{
    'status': {
        values: [
            { value: '1', label: 'Actif' },
            { value: '0', label: 'Inactif' }
        ]
    }
}</code></pre>

<h2>Méthodes Publiques</h2>
<table>
    <thead>
        <tr>
            <th>Méthode</th>
            <th>Arguments</th>
            <th>Description</th>
            <th>Retour</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>getValue(cell)</code></td>
            <td>cell: HTMLElement</td>
            <td>Obtient la valeur actuelle d'une cellule</td>
            <td>string</td>
        </tr>
        <tr>
            <td><code>setValue(cell, value)</code></td>
            <td>cell: HTMLElement, value: string</td>
            <td>Définit la valeur d'une cellule</td>
            <td>void</td>
        </tr>
        <tr>
            <td><code>getLabel(columnId, value)</code></td>
            <td>columnId: string, value: string</td>
            <td>Obtient le libellé pour une valeur</td>
            <td>string</td>
        </tr>
        <tr>
            <td><code>refresh()</code></td>
            <td>-</td>
            <td>Rafraîchit tous les choix</td>
            <td>void</td>
        </tr>
    </tbody>
</table>

<h2>Structure HTML</h2>
<p>Exemple de structure HTML avec support des choix :</p>
<pre><code>&lt;table id="monTableau"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;ID&lt;/th&gt;
            &lt;th th-choice="status"&gt;Statut&lt;/th&gt;
            &lt;th th-choice="priority"&gt;Priorité&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;tr&gt;
            &lt;td&gt;1&lt;/td&gt;
            &lt;td&gt;1&lt;/td&gt;
            &lt;td&gt;high&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;</code></pre>

<h2>Styles CSS</h2>
<p>Styles recommandés pour le plugin Choice :</p>
<pre><code>/* Style de base pour les cellules avec choix */
.choice-cell {
    position: relative;
}

.choice-cell select {
    width: 100%;
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 3px;
    background-color: #fff;
}

/* Style pour les cellules modifiées */
.choice-cell.modified {
    background-color: #fff3cd;
}

/* Style pour les cellules en lecture seule */
.choice-cell.readonly select {
    background-color: #e9ecef;
    cursor: not-allowed;
}

/* Style au survol */
.choice-cell select:hover:not([disabled]) {
    border-color: #80bdff;
}

/* Style au focus */
.choice-cell select:focus {
    outline: none;
    border-color: #80bdff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}</code></pre>

<h2>Intégration avec d'autres plugins</h2>
<ul>
    <li><strong>Plugin Edit</strong> :
        <ul>
            <li>Les cellules avec choix peuvent être rendues non éditables</li>
            <li>Support de la validation des modifications</li>
        </ul>
    </li>
    <li><strong>Plugin Filter</strong> :
        <ul>
            <li>Filtrage basé sur les valeurs ou les libellés</li>
            <li>Support des filtres personnalisés</li>
        </ul>
    </li>
    <li><strong>Plugin Sort</strong> :
        <ul>
            <li>Tri basé sur les valeurs ou les libellés</li>
            <li>Support du tri personnalisé</li>
        </ul>
    </li>
</ul>

<h2>Exemples d'Utilisation Avancée</h2>

<h3>1. Choix Dynamiques</h3>
<pre><code>const table = new NvTblHandler({
    tableId: 'monTableau',
    plugins: {
        Choice: {
            choices: {
                'departement': {
                    values: async () => {
                        const response = await fetch('/api/departements');
                        const data = await response.json();
                        return data.map(d => ({
                            value: d.id,
                            label: d.nom
                        }));
                    }
                }
            }
        }
    }
});</code></pre>

<h3>2. Validation Personnalisée</h3>
<pre><code>const table = new NvTblHandler({
    tableId: 'monTableau',
    plugins: {
        Choice: {
            choices: {
                'status': {
                    values: [
                        { value: 'active', label: 'Actif' },
                        { value: 'inactive', label: 'Inactif' }
                    ],
                    validate: (value, cell) => {
                        if (value === 'inactive') {
                            const reason = prompt('Raison de la désactivation :');
                            if (!reason) return false;
                            cell.setAttribute('data-reason', reason);
                        }
                        return true;
                    }
                }
            }
        }
    }
});</code></pre>

<h3>3. Événements et Mise à Jour en Cascade</h3>
<pre><code>const table = new NvTblHandler({
    tableId: 'monTableau',
    plugins: {
        Choice: {
            choices: {
                'pays': {
                    values: [
                        { value: 'FR', label: 'France' },
                        { value: 'BE', label: 'Belgique' }
                    ],
                    onChange: async (value, cell) => {
                        const row = cell.closest('tr');
                        const villeCell = row.querySelector('[data-column="ville"]');
                        const villes = await loadVilles(value);
                        updateVilleChoices(villeCell, villes);
                    }
                }
            }
        }
    }
});</code></pre>

<div class="note">
<h3>Notes Importantes</h3>
<ul>
    <li>Les valeurs doivent toujours être des chaînes de caractères</li>
    <li>La structure des choix doit être un tableau d'objets avec value et label</li>
    <li>Les modifications sont suivies et peuvent être annulées</li>
    <li>Les événements sont déclenchés après la validation</li>
    <li>Le mode debug permet de tracer les opérations du plugin</li>
</ul>
</div>

</body>
</html>
