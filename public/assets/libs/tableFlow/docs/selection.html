<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin Selection - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="../src/tableFlow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles spécifiques à cette page de documentation */
        /* NOTE: Il est préférable de définir les styles TableFlow dans un fichier CSS dédié */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav latérale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         /* Style pour la cohérence */
         tr.modified td { background-color: var(--tf-modified-bg, #fffbeb); }

         /* Styles pour Selection (normalement dans tableFlow.css) */
         td.selected {
             /* Utilise les variables CSS définies dans tableFlow.css ou documentation.css */
             background-color: var(--tf-selection-bg, rgba(79, 70, 229, 0.1)) !important;
             /* Appliquer l'outline conditionnellement basé sur la config showSelectionBorder */
             /* Ici, on suppose qu'elle est activée pour l'exemple visuel */
             outline: 1px solid var(--tf-selection-border, rgba(79, 70, 229, 0.4)) !important;
             outline-offset: -1px; /* Bordure intérieure */
             position: relative; z-index: 1;
         }
         tr.row-selected td { /* Surlignage ligne */
             background-color: var(--tf-selection-row-col-bg, rgba(79, 70, 229, 0.05)) !important;
         }
         td.col-selected { /* Surlignage colonne */
             background-color: var(--tf-selection-row-col-bg, rgba(79, 70, 229, 0.05)) !important;
         }
         .table-drag-selecting { /* Empêche sélection texte pendant drag */
             user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
         }
         /* Styles Menu Contextuel (si utilisé, normalement dans tableFlow.css) */
         /* Ces styles sont pour le menu interne si ContextMenuPlugin n'est pas utilisé */
         .selection-context-menu{position:absolute;background-color:var(--tf-bg-color,white);border:1px solid var(--tf-border-color,#ccc);border-radius:var(--tf-border-radius,4px);box-shadow:0 2px 5px rgba(0,0,0,.15);padding:5px 0;z-index:1051;min-width:150px;font-size:.9em}
         .selection-context-menu ul{list-style-type:none;margin:0;padding:0}
         .selection-context-menu li{padding:8px 15px;cursor:pointer;display:flex;align-items:center;gap:8px;white-space:nowrap;color:var(--tf-text-color)}
         .selection-context-menu li:hover{background-color:var(--tf-choice-option-hover-bg,#f5f5f5)}
         .selection-context-menu li i{color:var(--tf-primary-color,#4f46e5);opacity:.8;width:16px;text-align:center;flex-shrink:0}
         .selection-context-menu .separator{height:1px;background-color:var(--tf-border-color,#eee);margin:4px 0}
         /* Styles Menu Contextuel via le plugin ContextMenu (tf-*) */
         .tf-context-menu{position:fixed;z-index:1050;display:none;min-width:180px;padding:5px 0;margin:0;font-size:.9rem;color:var(--tf-text-color,#1f2937);text-align:left;list-style:none;background-color:var(--tf-bg-color,#fff);background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:var(--tf-border-radius,4px);box-shadow:0 .5rem 1rem rgba(0,0,0,.175)}
         .tf-menu-item{display:flex;align-items:center;padding:8px 15px;font-weight:400;color:var(--tf-text-color,#1f2937);text-align:inherit;white-space:nowrap;background-color:transparent;border:0;cursor:pointer;} .tf-menu-item:hover{background-color:var(--tf-choice-option-hover-bg,#f5f5f5)}
         .tf-menu-item .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center;flex-shrink:0} .tf-menu-item .menu-label{flex-grow:1}
         .tf-menu-separator{height:1px;margin:5px 0;overflow:hidden;background-color:var(--tf-border-color,#e5e7eb)} .tf-menu-header{display:block;padding:5px 15px;margin-bottom:0;font-size:.8em;color:var(--tf-text-muted-color,#6b7280);white-space:nowrap;font-weight:700}
         /* Info de sélection */
         #selectionInfo { margin-top: 1rem; font-style: italic; color: #555; }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin Selection</h1>

            <section id="plugin-selection-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>Selection</strong> (nom interne: `select`) offre des fonctionnalités avancées pour sélectionner des cellules (`<td>`), des lignes (`<tr>`) ou des colonnes dans un tableau TableFlow.
                </p>
                <p>
                    Il supporte plusieurs modes et méthodes de sélection :
                </p>
                <ul>
                    <li><strong>Modes :</strong> `'cell'` (défaut), `'row'`, `'column'`, `'multiple'` (sélection rectangulaire par glisser).</li>
                    <li><strong>Méthodes :</strong>
                        <ul>
                            <li>Clic simple pour sélectionner un élément (cellule, ligne, colonne).</li>
                            <li>Clic + `Ctrl`/`Cmd` pour ajouter/retirer des éléments à la sélection.</li>
                            <li>Clic + `Shift` pour étendre la sélection (sélectionne la plage entre le dernier clic et le clic actuel).</li>
                            <li>Glisser-déposer (souris) pour sélectionner une plage rectangulaire de cellules (mode `cell` ou `multiple`).</li>
                            <li>Navigation au clavier (touches fléchées, avec ou sans `Shift`) pour déplacer ou étendre la sélection.</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    Le plugin fournit également des actions intégrées sur la sélection, déclenchables via le menu contextuel (si <a href="contextmenu.html">ContextMenu</a> est actif) ou par raccourcis clavier :
                </p>
                <ul>
                    <li>Copier (`Ctrl+C`)</li>
                    <li>Couper (`Ctrl+X` = Copier + Effacer)</li>
                    <li>Coller (`Ctrl+V`)</li>
                    <li>Effacer le contenu (`Suppr`/`Backspace`)</li>
                    <li>Tout sélectionner (`Ctrl+A`)</li>
                </ul>
                <p>
                    Il utilise l'API Clipboard (`navigator.clipboard`) pour interagir avec le presse-papiers système lorsque c'est possible, avec un fallback sur `document.execCommand` (moins fiable et potentiellement bloqué par les navigateurs).
                </p>
                 <div class="info-block">
                    <strong>Dépendance Optionnelle :</strong> Pour afficher les actions (Copier, Couper, etc.) dans un menu contextuel au clic droit, le plugin <strong>ContextMenu</strong> doit être activé et configuré. Si ContextMenu n'est pas présent, Selection peut afficher son propre menu contextuel basique (configurable via `showContextMenu: true` et `menuItems` dans la config de Selection).
                 </div>
            </section>

            <section id="plugin-selection-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Ce plugin est activé uniquement via la configuration JavaScript (`plugins.names: ['Selection', ...]`). Il ne nécessite <strong>aucun attribut HTML spécifique</strong> sur les éléments `<th>` ou `<td>` pour fonctionner.
                </p>
                <p>
                    Les modes de sélection et les comportements sont définis dans la configuration JavaScript.
                </p>
            </section>

            <section id="plugin-selection-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration du plugin se fait dans l'objet d'options de `TableFlow`, sous la clé <code class="value">plugins.select</code> (notez le nom court 'select' utilisé comme clé).
                </p>
                <pre><code class="language-javascript">// Exemple d'initialisation de TableFlow
import TableFlow from '../src/tableFlow.js'; // Ajustez le chemin

const tableSel = new TableFlow({
    tableId: 'maTableSelection',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: ['Selection', 'ContextMenu'], // Activer Selection et ContextMenu
        select: { // Configuration spécifique pour 'Selection' (clé = 'select')
            // --- Options de Sélection ---
            mode: 'multiple', // Permet sélection rectangulaire par drag
            // selectionClass: 'selected', // Défaut
            // rowClass: 'row-selected', // Défaut
            // columnClass: 'col-selected', // Défaut
            enableKeyboard: true, // Activer navigation clavier (défaut)
            enableMouseDrag: true, // Activer drag souris (défaut)
            shiftSelect: true, // Activer Shift+Clic (défaut)
            ctrlSelect: true, // Activer Ctrl/Cmd+Clic (défaut)

            // --- Apparence ---
            showSelectionBorder: true, // Afficher bordure (défaut)
            highlightRow: false, // Ne pas surligner toute la ligne
            highlightColumn: false, // Ne pas surligner toute la colonne

            // --- Callbacks (Optionnel) ---
            onSelectionChange: (details) => {
                console.log('Sélection modifiée:', details);
                // details = { cells: Set<td_element>, rows: Set<tr_element>, columns: Set<col_index>, data: {...} }
                const selectedCellCount = details.cells.size;
                const infoElement = document.getElementById('selectionInfo');
                if (infoElement) {
                    infoElement.textContent = `${selectedCellCount} cellule(s) sélectionnée(s).`;
                }
            },
            // onSelect: (details) => { console.log('Élément sélectionné:', details); },
            // onDeselect: (details) => { console.log('Élément désélectionné:', details); },

            // --- Menu Contextuel ---
            showContextMenu: true, // Afficher le menu (défaut)
            // Utiliser les items par défaut (Copier, Couper, Coller, Effacer)
            // ou personnaliser :
            // menuItems: [
            //     { label: 'Copier Valeurs', action: 'copy', icon: '...' },
            //     { type: 'separator' },
            //     { label: 'Action Perso', action: 'customAction', icon: '...' }
            // ],

            // --- Actions Clavier ---
            enableCopyPaste: true, // Activer Ctrl+C/X/V (défaut)
            enableDelete: true, // Activer Suppr/Backspace (défaut)

            // --- Debug ---
            // debug: true // Logs spécifiques (hérite de global si non défini)
        },
        contextmenu: { /* ... config ContextMenu ... */ }
    }
});
</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.select`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin Selection via l'objet `plugins.select`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.select`)</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">mode</code></td><td class="type">string</td><td><code class="default">'cell'</code></td><td>Mode de sélection principal : `'cell'` (cellules individuelles), `'row'` (lignes entières), `'column'` (colonnes entières), `'multiple'` (sélection rectangulaire de cellules par glisser).</td></tr>
                        <tr><td><code class="attr">selectionClass</code></td><td class="type">string</td><td><code class="default">'selected'</code></td><td>Classe CSS ajoutée aux éléments `<td>` actuellement sélectionnés.</td></tr>
                        <tr><td><code class="attr">rowClass</code></td><td class="type">string</td><td><code class="default">'row-selected'</code></td><td>Classe CSS ajoutée aux éléments `<tr>` qui contiennent au moins une cellule sélectionnée (si `highlightRow` est `true`) ou qui sont entièrement sélectionnés (mode `row`).</td></tr>
                        <tr><td><code class="attr">columnClass</code></td><td class="type">string</td><td><code class="default">'col-selected'</code></td><td>Classe CSS ajoutée aux éléments `<td>` appartenant à une colonne qui contient au moins une cellule sélectionnée (si `highlightColumn` est `true`) ou qui est entièrement sélectionnée (mode `column`).</td></tr>
                        <tr><td><code class="attr">enableKeyboard</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Active la navigation (flèches) et les actions (Ctrl+C/X/V, Suppr) au clavier.</td></tr>
                        <tr><td><code class="attr">enableMouseDrag</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Active la sélection par glisser-déposer de la souris (pour les modes `cell` et `multiple`).</td></tr>
                        <tr><td><code class="attr">shiftSelect</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Permet d'étendre la sélection en maintenant la touche `Shift` enfoncée lors d'un clic.</td></tr>
                        <tr><td><code class="attr">ctrlSelect</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Permet d'ajouter ou de retirer des éléments (cellules, lignes, colonnes selon le mode) à la sélection en maintenant `Ctrl` (ou `Cmd` sur Mac) enfoncée lors d'un clic.</td></tr>
                        <tr><td><code class="attr">showSelectionBorder</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, applique un `outline` CSS aux cellules sélectionnées (via la classe `selectionClass`).</td></tr>
                        <tr><td><code class="attr">highlightRow</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, ajoute la classe `rowClass` aux `<tr>` contenant des cellules sélectionnées pour un surlignage visuel.</td></tr>
                        <tr><td><code class="attr">highlightColumn</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, ajoute la classe `columnClass` aux `<td>` des colonnes contenant des cellules sélectionnées pour un surlignage visuel.</td></tr>
                        <tr><td><code class="attr">onSelect</code></td><td class="type">function</td><td><code class="default">null</code></td><td>Callback appelé lorsqu'un élément (cellule, ligne, colonne) est sélectionné. Reçoit un objet `{ type, element, data }`.</td></tr>
                        <tr><td><code class="attr">onDeselect</code></td><td class="type">function</td><td><code class="default">null</code></td><td>Callback appelé lorsqu'un élément est désélectionné. Reçoit un objet `{ type, element }`.</td></tr>
                        <tr><td><code class="attr">onSelectionChange</code></td><td class="type">function</td><td><code class="default">null</code></td><td>Callback appelé après toute modification de la sélection (fin de drag, clic, action clavier). Reçoit un objet `{ cells: Set, rows: Set, columns: Set, data: object }`.</td></tr>
                        <tr><td><code class="attr">showContextMenu</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, tente d'ajouter des options au menu contextuel. S'intègre avec `ContextMenuPlugin` s'il est présent, sinon affiche son propre menu basique.</td></tr>
                        <tr><td><code class="attr">menuItems</code></td><td class="type">Array&lt;object&gt;</td><td><code class="default">[...]</code> (Copier, Couper, Coller, Effacer)</td><td>Tableau définissant les items à afficher dans le menu contextuel (interne ou via `ContextMenuPlugin`). Chaque objet suit la structure attendue par `ContextMenuPlugin` (`{ label, action, icon?, type? }`).</td></tr>
                        <tr><td><code class="attr">enableCopyPaste</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Active les raccourcis clavier `Ctrl+C`, `Ctrl+X`, `Ctrl+V` pour copier/couper/coller.</td></tr>
                        <tr><td><code class="attr">enableDelete</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Active les touches `Suppr` et `Backspace` pour effacer le contenu des cellules sélectionnées.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs spécifiques à ce plugin.</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="plugin-selection-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`):</strong> Attache les écouteurs d'événements (`mousedown`, `mouseover` sur `tbody`, `mouseup`, `click`, `keydown` sur `document`). S'enregistre comme fournisseur auprès de `ContextMenuPlugin` si configuré et disponible.</li>
                    <li><strong>Gestion de la Sélection (Souris) (`handleMouseDown`, `handleMouseOver`, `handleMouseUp`):</strong>
                        <ul>
                            <li>`mousedown`: Détecte le début de l'interaction. Selon le mode (`cell`, `row`, `column`, `multiple`) et les touches modificatrices (`Shift`, `Ctrl`), appelle `clearSelection`, `selectCell`/`selectRow`/`selectColumn`, ou `extendSelectionToCell`. Met `selection.active = true` et ajoute une classe au `body` pour le drag.</li>
                            <li>`mouseover`: Si `selection.active` est `true` (drag en cours) et en mode `cell`/`multiple`, appelle `extendSelectionToCell` pour ajuster le rectangle de sélection.</li>
                            <li>`mouseup`: Met `selection.active = false`, retire la classe du `body`, et appelle `triggerSelectionChange` pour finaliser la sélection.</li>
                        </ul>
                    </li>
                     <li><strong>Gestion de la Sélection (Clavier) (`handleKeyDown`, `navigateSelection`):</strong>
                        <ul>
                            <li>`handleKeyDown`: Intercepte les touches fléchées, `Ctrl+C/X/V/A`, `Suppr`/`Backspace`. Ignore si focus dans un input hors table.</li>
                            <li>`navigateSelection`: Calcule la cellule cible en fonction de la flèche. Si `Shift` est pressé, appelle `extendSelectionToCell`. Sinon, appelle `clearSelection` puis `selectCell` sur la cible. Assure la visibilité de la cellule cible (`scrollIntoView`). Appelle `triggerSelectionChange`.</li>
                        </ul>
                    </li>
                    <li><strong>Sélection/Désélection (`selectCell`, `deselectCell`, etc.):</strong> Ajoute/retire les éléments (`<td>`, `<tr>`, index de colonne) aux `Set` internes (`selection.cells`, `selection.rows`, `selection.columns`). Ajoute/retire les classes CSS correspondantes (`selectionClass`, `rowClass`, `columnClass`). Appelle `updateRowColumnHighlight` pour mettre à jour le surlignage global. Appelle les callbacks `onSelect`/`onDeselect`.</li>
                    <li><strong>Extension (`extendSelectionToCell`):</strong> Calcule le rectangle entre `startCell` et la cellule cible. Efface la sélection précédente et sélectionne toutes les cellules dans ce rectangle. Met à jour `lastCell`.</li>
                    <li><strong>Surlignage Ligne/Colonne (`updateRowColumnHighlight`):</strong> Réinitialise toutes les classes `rowClass`/`columnClass`. Identifie les lignes/colonnes contenant des cellules sélectionnées. Réapplique les classes `rowClass`/`columnClass` si les options `highlightRow`/`highlightColumn` sont `true`.</li>
                    <li><strong>Effacement (`clearSelection`):</strong> Vide les `Set` de sélection, retire toutes les classes CSS associées, réinitialise `startCell`/`lastCell`, et appelle `triggerSelectionChange`.</li>
                    <li><strong>Organisation (`organizeSelection`):</strong> Crée une grille 2D (tableau de tableaux) représentant le rectangle englobant la sélection actuelle. Les cellules non sélectionnées dans ce rectangle sont représentées par `null`.</li>
                    <li><strong>Copier/Couper/Coller (`copySelection`, `cutSelection`, `pasteSelection`, `copyToClipboardFallback`):</strong>
                        <ul>
                            <li>`copySelection`: Organise la sélection, crée une chaîne TSV (Tab Separated Values), la stocke dans `selection.clipboard`, et tente de la copier dans le presse-papiers système via `navigator.clipboard.writeText`. Utilise un fallback `document.execCommand('copy')` si l'API Clipboard échoue.</li>
                            <li>`cutSelection`: Appelle `copySelection` puis `deleteSelectionContent`.</li>
                            <li>`pasteSelection`: Tente de lire le presse-papiers système via `navigator.clipboard.readText`. Si échoue ou non disponible, utilise `selection.clipboard`. Parse le texte (supposé TSV). Itère sur les données et met à jour les cellules de la table à partir de la cellule active (`lastCell` ou première sélectionnée) via `updateCellValue`.</li>
                        </ul>
                    </li>
                     <li><strong>Effacer Contenu (`deleteSelectionContent`):</strong> Itère sur `selection.cells` et appelle `updateCellValue(cell, '')` pour chaque cellule, ce qui met à jour la valeur et déclenche `cell:change`.</li>
                    <li><strong>Mise à Jour Cellule (`updateCellValue`):</strong> Méthode interne appelée par `pasteSelection` et `deleteSelectionContent`. Met à jour `data-value`, l'affichage (via sanitizer si possible), et déclenche `cell:change` avec `source: 'selection'`.</li>
                    <li><strong>Menu Contextuel (`handleContextMenu`, `showInternalContextMenu`, `removeInternalContextMenu`, `handleContextMenuAction`, `getMenuItems`, `executeAction`):</strong> Gère l'affichage d'un menu contextuel interne si `ContextMenuPlugin` n'est pas utilisé. Implémente l'interface fournisseur (`getMenuItems`, `executeAction`) pour s'intégrer avec `ContextMenuPlugin`.</li>
                    <li><strong>Nettoyage (`destroy`):</strong> Supprime tous les écouteurs d'événements attachés, se désenregistre de `ContextMenuPlugin`, efface la sélection et les références internes.</li>
                </ul>
            </section>

             <section id="plugin-selection-api">
                <h2>API Publique</h2>
                <p>Le plugin Selection expose plusieurs méthodes pour contrôler la sélection par programmation.</p>
                 <pre><code class="language-javascript">// Obtenir l'instance du plugin (après initialisation de TableFlow)
const myTableFlowInstance = new TableFlow({ tableId: 'maTableSelection', /* ... */ });
await myTableFlowInstance.ready(); // Attendre l'initialisation
const selectionPlugin = myTableFlowInstance.getPlugin('select'); // Utilise le nom court 'select'

if (selectionPlugin) {
    // Sélectionner une cellule spécifique par son ID
    selectionPlugin.selectCellById('colB_s_r2');

    // Effacer la sélection
    // selectionPlugin.clearSelection();

    // Sélectionner toutes les cellules
    // selectionPlugin.selectAll();

    // Obtenir les données sélectionnées
    const selectedData = selectionPlugin.getSelectedData();
    console.log('Données sélectionnées:', selectedData);
    // { cells: [...], rows: [...], columns: {...} }

    // Effectuer une action (si activée)
    // selectionPlugin.doAction('copy'); // Copie la sélection actuelle
    // Autres actions: 'cut', 'paste', 'delete', 'selectAll', 'clear'
}
</code></pre>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Méthode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code>clearSelection()</code></td><td>-</td><td>Efface toute sélection active (cellules, lignes, colonnes) et réinitialise l'état.</td><td class="type">void</td></tr>
                         <tr><td><code>selectAll()</code></td><td>-</td><td>Sélectionne toutes les cellules du tableau.</td><td class="type">void</td></tr>
                         <tr><td><code>selectCellById(cellId, clearPrevious?)</code></td><td><code class="attr">cellId</code> <span class="type">(string)</span><br><code class="attr">clearPrevious</code> <span class="type">(boolean, défaut: true)</span></td><td>Sélectionne la cellule avec l'ID donné. Si `clearPrevious` est `true`, efface la sélection précédente.</td><td class="type">boolean (succès)</td></tr>
                         <tr><td><code>getSelectedData()</code></td><td>-</td><td>Retourne un objet contenant les données des éléments actuellement sélectionnés, structurées par type (cells, rows, columns).</td><td class="type">object</td></tr>
                         <tr><td><code>doAction(action)</code></td><td><code class="attr">action</code> <span class="type">(string)</span></td><td>Exécute une action prédéfinie sur la sélection actuelle. Actions possibles: `'copy'`, `'cut'`, `'paste'`, `'delete'`, `'selectAll'`, `'clear'`.</td><td class="type">boolean (succès)</td></tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-selection-events">
                <h2>Événements</h2>
                <ul>
                    <li><strong>Écoutés :</strong> `mousedown`, `mouseover` (sur `tbody`), `mouseup`, `click`, `keydown` (sur `document`), `contextmenu` (sur `table`), `row:added`, `row:removed` (sur `table`).</li>
                    <li><strong>Déclenchés (sur l'élément `<table>`) :</strong>
                        <ul>
                            <li><code>selection:change</code> : Déclenché après chaque modification de la sélection (fin de drag, clic, action clavier). Contient `{ detail: { cells: Set, rows: Set, columns: Set, data: object } }`.</li>
                            <li><code>cells:pasted</code> : Déclenché après une opération de collage réussie. Contient `{ detail: { cells: Array<HTMLTableCellElement>, startCell: HTMLTableCellElement, data: Array<Array<string>> } }`.</li>
                            <li><code>cells:contentDeleted</code> : Déclenché après l'effacement du contenu via `Suppr`/`Backspace` ou `cut`. Contient `{ detail: { cells: Array<HTMLTableCellElement> } }`.</li>
                            <li><code>selection:action</code> : Déclenché lorsqu'une action personnalisée (non gérée par défaut) est appelée depuis le menu contextuel. Contient `{ detail: { action: string, selection: object } }`.</li>
                            <li>(Indirectement) Déclenche <code>cell:change</code> lors des opérations `paste` et `delete`.</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section id="plugin-selection-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple active la sélection multiple par glisser, la navigation clavier, et les actions Copier/Coller/Effacer via clavier et menu contextuel.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple Selection Plugin&lt;/title&gt;
    &lt;link rel="stylesheet" href="../src/tableFlow.css"&gt;
    &lt;link rel="stylesheet" href="documentation.css"&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"&gt;
    &lt;style&gt;
        body { padding: 2rem; font-family: sans-serif; }
        table { width: 100%; border-collapse: collapse; user-select: none; /* Empêcher sélection texte native */ }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        thead th { background-color: #f2f2f2; }
        /* Styles Selection (normalement dans tableFlow.css) */
        td.selected{background-color:rgba(79,70,229,.1)!important;outline:1px solid rgba(79,70,229,.4)!important;outline-offset:-1px;position:relative;z-index:1}
        tr.row-selected td{background-color:rgba(79,70,229,.05)!important}
        td.col-selected{background-color:rgba(79,70,229,.05)!important}
        .table-drag-selecting{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}
        /* Styles Menu (normalement dans tableFlow.css) */
        .tf-context-menu{position:fixed;z-index:1050;display:none;min-width:180px;padding:5px 0;margin:0;font-size:.9rem;color:#1f2937;text-align:left;list-style:none;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:4px;box-shadow:0 .5rem 1rem rgba(0,0,0,.175)}
        .tf-menu-item{display:flex;align-items:center;padding:8px 15px;font-weight:400;color:#1f2937;text-align:inherit;white-space:nowrap;background-color:transparent;border:0;cursor:pointer;} .tf-menu-item:hover{background-color:#f5f5f5}
        .tf-menu-item .menu-icon{margin-right:8px;font-size:1.1em;width:20px;text-align:center;flex-shrink:0} .tf-menu-item .menu-label{flex-grow:1}
        .tf-menu-separator{height:1px;margin:5px 0;overflow:hidden;background-color:#e5e7eb} .tf-menu-header{display:block;padding:5px 15px;margin-bottom:0;font-size:.8em;color:#6b7280;white-space:nowrap;font-weight:700}
        #selectionInfo { margin-top: 1rem; font-style: italic; color: #555; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin Selection&lt;/h1&gt;
    &lt;p&gt;Cliquez, glissez, utilisez Shift+Clic, Ctrl+Clic, les flèches (avec Shift), Ctrl+C/X/V, Suppr.&lt;/p&gt;

    &lt;table id="selectionTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="selA"&gt;A&lt;/th&gt;&lt;th id="selB"&gt;B&lt;/th&gt;&lt;th id="selC"&gt;C&lt;/th&gt;&lt;th id="selD"&gt;D&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="s_r1"&gt;&lt;td id="selA_s_r1"&gt;A1&lt;/td&gt;&lt;td id="selB_s_r1"&gt;B1&lt;/td&gt;&lt;td id="selC_s_r1"&gt;C1&lt;/td&gt;&lt;td id="selD_s_r1"&gt;D1&lt;/td&gt;&lt;/tr&gt;
            &lt;tr id="s_r2"&gt;&lt;td id="selA_s_r2"&gt;A2&lt;/td&gt;&lt;td id="selB_s_r2"&gt;B2&lt;/td&gt;&lt;td id="selC_s_r2"&gt;C2&lt;/td&gt;&lt;td id="selD_s_r2"&gt;D2&lt;/td&gt;&lt;/tr&gt;
            &lt;tr id="s_r3"&gt;&lt;td id="selA_s_r3"&gt;A3&lt;/td&gt;&lt;td id="selB_s_r3"&gt;B3&lt;/td&gt;&lt;td id="selC_s_r3"&gt;C3&lt;/td&gt;&lt;td id="selD_s_r3"&gt;D3&lt;/td&gt;&lt;/tr&gt;
            &lt;tr id="s_r4"&gt;&lt;td id="selA_s_r4"&gt;A4&lt;/td&gt;&lt;td id="selB_s_r4"&gt;B4&lt;/td&gt;&lt;td id="selC_s_r4"&gt;C4&lt;/td&gt;&lt;td id="selD_s_r4"&gt;D4&lt;/td&gt;&lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;div id="selectionInfo"&gt;0 cellule(s) sélectionnée(s).&lt;/div&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez

        const selTable = new TableFlow({
            tableId: 'selectionTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['Selection', 'ContextMenu'], // Activer les deux
                select: { // Configurer Selection
                    mode: 'multiple', // Activer drag rectangulaire
                    highlightRow: true, // Surligner lignes
                    highlightColumn: true, // Surligner colonnes
                    showContextMenu: true, // Utiliser ContextMenuPlugin
                    onSelectionChange: (details) => { // Mettre à jour l'info
                        const count = details.cells.size;
                        document.getElementById('selectionInfo').textContent = `${count} cellule(s) sélectionnée(s).`;
                    }
                    // Utiliser les items de menu et actions clavier par défaut
                },
                contextmenu: { /* config par défaut */ }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>Cliquez sur une cellule (ex: B2) : elle est sélectionnée.</li>
                    <li>Cliquez et glissez de B2 à C3 : les cellules B2, C2, B3, C3 sont sélectionnées. Les lignes 2 et 3, et les colonnes B et C sont légèrement surlignées.</li>
                    <li>Maintenez `Shift` et cliquez sur D4 : la sélection s'étend de B2 (le `startCell`) à D4, sélectionnant B2:D4.</li>
                    <li>Maintenez `Ctrl` (ou `Cmd`) et cliquez sur C3 : C3 est désélectionnée.</li>
                    <li>Maintenez `Ctrl` et cliquez sur A1 : A1 est ajoutée à la sélection.</li>
                    <li>Utilisez les flèches pour déplacer la "dernière cellule active" (la navigation simple efface la sélection précédente).</li>
                    <li>Utilisez `Shift` + Flèches pour étendre la sélection rectangulaire depuis la cellule de départ (`startCell`).</li>
                    <li>Appuyez sur `Ctrl+C` : le contenu des cellules sélectionnées (B2, C2, B3, C3 si c'est la sélection) est copié au format TSV dans le presse-papiers.</li>
                    <li>Cliquez sur A4, puis appuyez sur `Ctrl+V` : les données copiées (4 cellules) sont collées à partir de A4 (A4=B2, B4=C2, A5=B3?, B5=C3?). Attention, le collage ne crée pas de nouvelles lignes/colonnes ici.</li>
                    <li>Sélectionnez quelques cellules et appuyez sur `Suppr` : le contenu des cellules sélectionnées est effacé.</li>
                    <li>Faites un clic droit sur une cellule sélectionnée : le menu contextuel apparaît avec les options Copier, Couper, Coller, Effacer contenu.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>
