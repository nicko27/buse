<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin Validation - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="../src/tableFlow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles spécifiques à cette page */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav latérale */
         h1 { margin-bottom: 2rem; }
         /* Style pour la cohérence (ligne modifiée) */
         tr.modified td { background-color: var(--tf-modified-bg, #fffbeb); }

         /* Styles pour la validation (normalement dans tableFlow.css) */
         td.invalid {
             position: relative; /* Pour positionner l'erreur */
             background-color: var(--tf-invalid-bg, #fee2e2) !important; /* Important pour surcharger */
             outline: 1px solid var(--tf-invalid-border, #fca5a5);
             outline-offset: -1px;
         }
         .validation-error {
             color: var(--tf-error-text-color, #991b1b);
             font-size: 0.8em;
             margin-top: 4px;
             display: none; /* Caché par défaut */
             width: 100%; /* Prend la largeur */
         }
         td.invalid .validation-error {
             display: block; /* Afficher quand invalide */
         }
         /* Cellule éditable */
         td.td-edit { cursor: pointer; }
         /* Input d'édition */
         .edit-input { width: 100%; padding: var(--tf-input-padding, 4px 6px); border: 1px solid var(--tf-primary-color); border-radius: var(--tf-border-radius, 4px); font: inherit; box-sizing: border-box; outline: none; }
         .edit-input:focus { box-shadow: 0 0 0 2px var(--tf-focus-ring-color); }

    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin Validation</h1>

            <section id="plugin-validation-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>Validation</strong> s'intègre étroitement avec le plugin <a href="edit.html">Edit</a> pour valider les données saisies par l'utilisateur <em>avant</em> qu'elles ne soient sauvegardées (c'est-à-dire avant que l'input d'édition ne se ferme et que la valeur `data-value` ne soit mise à jour).
                </p>
                <p>
                    Il permet de définir des règles de validation pour chaque colonne éditable (ex: champ requis, longueur min/max, format numérique, email, date, expression régulière personnalisée). Si une règle n'est pas respectée :
                </p>
                <ul>
                    <li>La sauvegarde de la cellule est <strong>bloquée</strong>.</li>
                    <li>Un message d'erreur descriptif est affiché sous le champ d'édition.</li>
                    <li>Une classe CSS (par défaut `invalid`) est ajoutée à la cellule `<td>` pour un retour visuel.</li>
                    <li>Le focus reste généralement sur le champ d'édition pour permettre la correction.</li>
                </ul>
                <p>
                    Le plugin fournit plusieurs validateurs intégrés et permet d'enregistrer facilement des validateurs personnalisés via la configuration JavaScript.
                </p>
                 <div class="warning-block">
                    <strong>Dépendance Forte :</strong> Ce plugin <strong>nécessite</strong> que le plugin <strong>Edit</strong> soit activé et fonctionnel. Il s'appuie sur les hooks `beforeSave` et `afterEdit` exposés par EditPlugin pour fonctionner correctement.
                 </div>
            </section>

            <section id="plugin-validation-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Pour activer la validation sur une colonne <strong>déjà éditable</strong> (via `th-edit`), ajoutez l'attribut <code class="attr">th-validate</code> (configurable via `validateAttribute`) à l'élément <code>&lt;th&gt;</code> correspondant.
                </p>
                <p>
                    La valeur de cet attribut <strong>doit être une chaîne JSON valide</strong> représentant un objet où les clés sont les noms des règles de validation à appliquer et les valeurs sont la configuration de ces règles.
                </p>
                <pre><code class="language-html">&lt;table id="maTableValidation"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th id="colNom" th-edit
          th-validate='{
              "required": true,
              "maxLength": {"maxLength": 50}
          }'&gt;Nom (Requis, max 50)&lt;/th&gt;
      &lt;th id="colEmail" th-edit
          th-validate='{
              "email": true
          }'&gt;Email (Format email)&lt;/th&gt;
      &lt;th id="colAge" th-edit
          th-validate='{
              "number": {"min": 18, "max": 120, "integer": true},
              "required": true
          }'&gt;Âge (Requis, 18-120, entier)&lt;/th&gt;
       &lt;th id="colCodePostal" th-edit
           th-validate='{
               "regex": {"pattern": "^[0-9]{5}$", "patternMessage": "Doit être 5 chiffres."}
           }'&gt;Code Postal (5 chiffres)&lt;/th&gt;
       &lt;th id="colDateInscription" th-edit
           th-validate='{
               "date": {"minDate": "2024-01-01"}
           }'&gt;Date Inscription (après 2024)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr id="user1"&gt;
        &lt;td id="colNom_user1"&gt;Alice&lt;/td&gt;
        &lt;td id="colEmail_user1"&gt;alice@test.com&lt;/td&gt;
        &lt;td id="colAge_user1"&gt;30&lt;/td&gt;
        &lt;td id="colCodePostal_user1"&gt;75001&lt;/td&gt;
        &lt;td id="colDateInscription_user1"&gt;2024-03-15&lt;/td&gt;
    &lt;/tr&gt;
    &lt;!-- Autres lignes --&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
                <p>
                    Dans cet exemple :
                </p>
                <ul>
                    <li><strong>Nom :</strong> Est requis (`required: true`) et ne doit pas dépasser 50 caractères (`maxLength: {"maxLength": 50}`).</li>
                    <li><strong>Email :</strong> Doit être un email valide (`email: true`).</li>
                    <li><strong>Âge :</strong> Est requis, doit être un nombre (`number`) entier (`integer: true`) compris entre 18 et 120 (`min: 18, max: 120`).</li>
                    <li><strong>Code Postal :</strong> Doit correspondre à l'expression régulière `^[0-9]{5}$` (exactement 5 chiffres). Un message personnalisé est fourni.</li>
                     <li><strong>Date Inscription :</strong> Doit être une date valide et postérieure ou égale au 01/01/2024.</li>
                </ul>
                <p>Consultez la section Configuration JavaScript pour la liste complète des validateurs intégrés et leur configuration.</p>
            </section>

            <section id="plugin-validation-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    Bien que la plupart des règles puissent être définies via l'attribut HTML, la configuration JavaScript (<code class="value">plugins.validation</code>) permet :
                </p>
                <ul>
                    <li>D'activer/désactiver les logs de débogage spécifiques (`debug`).</li>
                    <li>De personnaliser les classes CSS utilisées (`invalidClass`, `errorClass`).</li>
                    <li>D'enregistrer de nouveaux validateurs personnalisés ou de surcharger les validateurs intégrés (`validators`).</li>
                </ul>
                <pre><code class="language-javascript">// Exemple d'initialisation de TableFlow
import TableFlow from '../src/tableFlow.js'; // Ajustez le chemin

const tableVal = new TableFlow({
    tableId: 'maTableValidation',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: ['Edit', 'Validation'], // Activer Edit et Validation
        validation: { // Configuration spécifique pour 'Validation'
            // --- Options Générales ---
            // validateAttribute: 'th-validate', // Défaut
            invalidClass: 'field-invalid', // Surcharger la classe pour cellule invalide
            errorClass: 'field-error-message', // Surcharger la classe pour message d'erreur
            // debug: true, // Logs spécifiques

            // --- Validateurs Personnalisés / Surcharges ---
            validators: {
                // Surcharger le message 'required'
                required: (value, isRequired) => {
                    if (isRequired && (value === null || value === undefined || String(value).trim() === '')) {
                        return 'Ce champ ne peut pas être vide !'; // Message personnalisé
                    }
                    return true;
                },
                // Ajouter un validateur personnalisé 'mustContain'
                mustContain: (value, config, cell) => {
                    // config devrait être {"text": "mot_a_contenir"} dans le JSON HTML
                    const textToContain = config?.text;
                    if (textToContain && value && !String(value).includes(textToContain)) {
                        return `Doit contenir le mot "${textToContain}".`;
                    }
                    return true;
                },
                // Ajouter un validateur asynchrone (exemple)
                isUnique: async (value, config, cell) => {
                    if (!value) return true; // Ne pas valider si vide
                    const columnId = cell.getAttribute('data-column-id'); // Suppose un attribut data-column-id
                    const rowId = cell.closest('tr')?.id;
                    try {
                        // Simuler un appel API pour vérifier l'unicité
                        const response = await fetch(`/api/checkUnique?column=${columnId}&value=${encodeURIComponent(value)}&excludeId=${rowId}`);
                        if (!response.ok) throw new Error('Erreur serveur');
                        const data = await response.json();
                        return data.isUnique ? true : `La valeur "${value}" existe déjà.`;
                    } catch (error) {
                         console.error("Erreur validateur isUnique:", error);
                         return "Erreur lors de la vérification de l'unicité."; // Message d'erreur générique
                    }
                }
            }
        },
        edit: { /* ... config Edit ... */ }
    }
});

// Utiliser le validateur personnalisé dans l'HTML :
// <th id="colRef" th-edit th-validate='{"mustContain": {"text": "REF-"}}'>Référence (doit contenir REF-)</th>
// <th id="colUnique" th-edit th-validate='{"isUnique": true}'>Code Unique (Async)</th>
</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.validation`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin Validation via l'objet `plugins.validation`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.validation`)</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">validateAttribute</code></td><td class="type">string</td><td><code class="default">'th-validate'</code></td><td>Nom de l'attribut HTML sur `<th>` contenant la configuration JSON des règles de validation pour la colonne.</td></tr>
                        <tr><td><code class="attr">invalidClass</code></td><td class="type">string</td><td><code class="default">'invalid'</code></td><td>Classe CSS ajoutée à la cellule `<td>` lorsque sa valeur est invalide.</td></tr>
                        <tr><td><code class="attr">errorClass</code></td><td class="type">string</td><td><code class="default">'validation-error'</code></td><td>Classe CSS ajoutée à l'élément `<div>` créé pour afficher le message d'erreur sous le champ d'édition.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage spécifiques au plugin Validation. Hérite du `debug` global si non défini.</td></tr>
                        <tr><td><code class="attr">validators</code></td><td class="type">object</td><td><code class="default">{...}</code> (voir code source)</td><td>Objet contenant les fonctions de validation. La clé est le nom de la règle (utilisé dans le JSON de `th-validate`), la valeur est la fonction de validation. Vous pouvez ajouter de nouvelles clés/fonctions ou surcharger celles existantes.</td></tr>
                    </tbody>
                </table>

                 <h3>Validateurs Intégrés et leur Configuration JSON</h3>
                 <div class="info-block">
                    Ce tableau décrit les validateurs fournis par défaut et comment les configurer dans l'attribut `th-validate`.
                 </div>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Nom de la Règle (Clé JSON)</th><th>Configuration JSON (Valeur)</th><th>Description</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code class="attr">required</code></td><td><code class="type">boolean</code> (<code class="value">true</code>)</td><td>La valeur ne peut pas être vide ou composée uniquement d'espaces.</td></tr>
                         <tr><td><code class="attr">maxLength</code></td><td><code class="type">object</code> (<code class="value">{"maxLength": number}</code>)</td><td>La longueur de la chaîne ne doit pas dépasser `maxLength`.</td></tr>
                         <tr><td><code class="attr">minLength</code></td><td><code class="type">object</code> (<code class="value">{"minLength": number}</code>)</td><td>La longueur de la chaîne (si non vide) doit être au moins `minLength`.</td></tr>
                         <tr><td><code class="attr">number</code></td><td><code class="type">object</code> (<code class="value">{min?: number, max?: number, integer?: boolean, step?: number|'any'}</code>)</td><td>La valeur doit être un nombre valide. Options : `min` (valeur minimale), `max` (valeur maximale), `integer: true` (doit être entier), `step` (incrément valide, ex: `1` pour entier, `0.01` pour 2 décimales, `'any'` par défaut).</td></tr>
                         <tr><td><code class="attr">email</code></td><td><code class="type">boolean</code> (<code class="value">true</code>)</td><td>La valeur doit avoir un format d'email valide (validation basique).</td></tr>
                         <tr><td><code class="attr">date</code></td><td><code class="type">object</code> (<code class="value">{minDate?: "YYYY-MM-DD", maxDate?: "YYYY-MM-DD"}</code>)</td><td>La valeur doit être une date valide. Options : `minDate` (date minimale incluse), `maxDate` (date maximale incluse).</td></tr>
                         <tr><td><code class="attr">regex</code></td><td><code class="type">object</code> (<code class="value">{pattern: string, patternMessage?: string, flags?: string}</code>)</td><td>La valeur doit correspondre à l'expression régulière fournie dans `pattern`. `patternMessage` est le message d'erreur personnalisé. `flags` sont les flags regex (ex: `'i'` pour insensible à la casse).</td></tr>
                         </tbody>
                 </table>
            </section>

            <section id="plugin-validation-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`):</strong>
                        <ul>
                            <li>Récupère l'instance du plugin `Edit` (requis).</li>
                            <li>Vérifie que `Edit` expose les méthodes `addHook`/`removeHook`.</li>
                            <li>Appelle `detectValidateColumns` pour lire les attributs `th-validate` et stocker les configurations JSON dans `this.validateColumns` (Map `columnIndex -> config`).</li>
                            <li>Appelle `registerWithEditPlugin` pour s'attacher aux hooks de `Edit`.</li>
                        </ul>
                    </li>
                    <li><strong>Enregistrement aux Hooks (`registerWithEditPlugin`):</strong>
                        <ul>
                            <li>Appelle `this.editPlugin.addHook('beforeSave', this._validateBeforeSave, 'Validation')`.</li>
                            <li>Appelle `this.editPlugin.addHook('afterEdit', this._setupValidationForInput, 'Validation')`.</li>
                        </ul>
                    </li>
                    <li><strong>Hook `afterEdit` (`_setupValidationForInput`):</strong>
                        <ul>
                            <li>Appelé par `Edit` après la création de l'input d'édition.</li>
                            <li>Récupère la configuration de validation pour la colonne de la cellule.</li>
                            <li>Si une configuration existe, configure les attributs de validation HTML5 sur l'input (`type`, `required`, `min`, `max`, `step`, `pattern`, `maxLength`, `minLength`) pour une validation native par le navigateur (facultative mais utile).</li>
                            <li>Ajoute un écouteur d'événement `input` à l'élément `<input>`.</li>
                            <li>Ce listener appelle `validateValue(cell, input.value, config)` à chaque modification pour une validation en temps réel et met à jour l'attribut `aria-invalid`.</li>
                            <li>Valide également la valeur initiale pour afficher une erreur immédiatement si nécessaire.</li>
                        </ul>
                    </li>
                    <li><strong>Hook `beforeSave` (`_validateBeforeSave`):</strong>
                        <ul>
                            <li>Appelé par `Edit` juste avant de sauvegarder la valeur modifiée.</li>
                            <li>Récupère la configuration de validation pour la colonne.</li>
                            <li>Appelle `validateValue(cell, newValue, config)` pour effectuer la validation finale.</li>
                            <li>Si `validateValue` retourne `false` (invalide) :
                                <ul>
                                    <li>Le message d'erreur est déjà affiché par `validateValue`.</li>
                                    <li>Retourne `false` à `Edit`, ce qui <strong>annule</strong> le processus de sauvegarde de `Edit`.</li>
                                </ul>
                            </li>
                            <li>Si `validateValue` retourne `true` (valide) :
                                <ul>
                                    <li>S'assure que tout message d'erreur précédent est effacé (`clearValidationError`).</li>
                                    <li>Retourne `true` à `Edit`, autorisant la sauvegarde.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Validation d'une Valeur (`validateValue`):</strong>
                        <ul>
                            <li>Itère sur les règles définies dans la configuration de la colonne.</li>
                            <li>Pour chaque règle, trouve la fonction validateur correspondante dans `this.config.validators`.</li>
                            <li>Appelle la fonction validateur avec la valeur, la configuration de la règle, et la cellule.</li>
                            <li>Si un validateur retourne une chaîne (message d'erreur), arrête la validation et appelle `showValidationError()`.</li>
                            <li>Si tous les validateurs retournent `true`, appelle `clearValidationError()`.</li>
                            <li>Retourne `true` si valide, `false` sinon.</li>
                        </ul>
                    </li>
                    <li><strong>Affichage/Masquage Erreur (`showValidationError`, `clearValidationError`):</strong>
                        <ul>
                            <li>Ajoute/retire la classe `invalidClass` à la cellule `<td>`.</li>
                            <li>Trouve ou crée un `<div>` avec la classe `errorClass` (généralement après le wrapper).</li>
                            <li>Affiche/masque ce `<div>` et met à jour son `textContent` avec le message d'erreur.</li>
                        </ul>
                    </li>
                     <li><strong>Nettoyage (`destroy`):</strong> Appelle `removeHook` sur `EditPlugin` pour se désenregistrer des hooks `beforeSave` et `afterEdit` en utilisant le namespace 'Validation'.</li>
                </ul>
            </section>

            <section id="plugin-validation-api">
                <h2>API Publique</h2>
                <p>
                    Le plugin Validation expose une méthode publique pour ajouter ou surcharger des validateurs.
                </p>
                <table class="documentation-table">
                     <thead>
                         <tr><th>Méthode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr>
                             <td><code>registerValidator(name, validatorFn)</code></td>
                             <td>
                                 <code class="attr">name</code> <span class="type">(string)</span><br>
                                 <code class="attr">validatorFn</code> <span class="type">(function)</span>
                             </td>
                             <td>
                                 Enregistre une nouvelle fonction de validation personnalisée ou remplace une fonction existante pour cette instance de TableFlow.
                                 <ul>
                                     <li>`name`: Nom de la règle (utilisé comme clé dans le JSON `th-validate`).</li>
                                     <li>`validatorFn`: Fonction `(value, config, cell) => boolean | string`. Doit retourner `true` si valide, ou une chaîne (message d'erreur) si invalide. `config` est la valeur associée à la clé `name` dans le JSON.</li>
                                 </ul>
                             </td>
                             <td class="type">this (ValidationPlugin instance)</td>
                         </tr>
                     </tbody>
                 </table>
            </section>

            <section id="plugin-validation-events">
                <h2>Événements</h2>
                <ul>
                    <li><strong>Écoutés :</strong> Aucun événement DOM direct. S'appuie sur les hooks `beforeSave` et `afterEdit` du plugin `Edit`.</li>
                    <li><strong>Déclenchés :</strong> Aucun événement spécifique déclenché par ce plugin. Son rôle est d'intercepter et potentiellement d'annuler le processus de sauvegarde du plugin `Edit`.</li>
                </ul>
            </section>

            <section id="plugin-validation-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre une table où plusieurs colonnes sont éditables et ont différentes règles de validation définies via l'attribut `th-validate`. Un validateur personnalisé `mustContain` est ajouté via JavaScript.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple Validation Plugin&lt;/title&gt;
    &lt;link rel="stylesheet" href="../src/tableFlow.css"&gt;
    &lt;link rel="stylesheet" href="documentation.css"&gt;
    &lt;style&gt;
        body { padding: 2rem; font-family: sans-serif; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top;}
        thead th { background-color: #f2f2f2; }
        tr.modified td { background-color: #fffbeb; }
        /* Styles Validation */
        td.field-invalid { background-color: #fee2e2 !important; outline: 1px solid #fca5a5; }
        .field-error-message { color: #991b1b; font-size: 0.8em; margin-top: 4px; display: none; }
        td.field-invalid .field-error-message { display: block; }
        td.td-edit { cursor: pointer; }
        .edit-input { width: 100%; padding: 4px 6px; border: 1px solid #4f46e5; border-radius: 4px; font: inherit; box-sizing: border-box; outline: none; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin Validation&lt;/h1&gt;
    &lt;p&gt;Double-cliquez pour éditer. Essayez d'entrer des valeurs invalides.&lt;/p&gt;

    &lt;table id="validationTable"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="valNom" th-edit th-validate='{"required": true, "maxLength": {"maxLength": 20}}'&gt;Nom (Req, Max 20)&lt;/th&gt;
                &lt;th id="valAge" th-edit th-validate='{"number": {"min": 0, "integer": true}}'&gt;Âge (Positif, Entier)&lt;/th&gt;
                &lt;th id="valCode" th-edit th-validate='{"mustContain": {"text": "CODE-"}}'&gt;Code (Doit contenir CODE-)&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="v1"&gt;
                &lt;td id="valNom_v1"&gt;Valide&lt;/td&gt;
                &lt;td id="valAge_v1"&gt;25&lt;/td&gt;
                &lt;td id="valCode_v1"&gt;CODE-123&lt;/td&gt;
            &lt;/tr&gt;
             &lt;tr id="v2"&gt;
                &lt;td id="valNom_v2"&gt;Nom Trop Looooooooooooong&lt;/td&gt;
                &lt;td id="valAge_v2"&gt;-5&lt;/td&gt;
                &lt;td id="valCode_v2"&gt;ABC-456&lt;/td&gt;
            &lt;/tr&gt;
             &lt;tr id="v3"&gt;
                &lt;td id="valNom_v3"&gt;&lt;/td&gt;
                &lt;td id="valAge_v3"&gt;30.5&lt;/td&gt;
                &lt;td id="valCode_v3"&gt;CODE-789&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez le chemin

        const valTable = new TableFlow({
            tableId: 'validationTable',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['Edit', 'Validation'], // Activer Edit et Validation
                validation: {
                    // Personnaliser les classes CSS
                    invalidClass: 'field-invalid',
                    errorClass: 'field-error-message',
                    // Ajouter notre validateur personnalisé
                    validators: {
                        mustContain: (value, config, cell) => {
                            const textToContain = config?.text;
                            if (textToContain && value && !String(value).includes(textToContain)) {
                                return `Doit contenir "${textToContain}".`;
                            }
                            return true;
                        }
                        // On pourrait aussi surcharger les messages des validateurs par défaut ici
                    }
                },
                edit: {
                    // Utiliser la config par défaut d'Edit
                }
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>Au chargement, la table s'affiche. Les colonnes sont éditables (double-clic).</li>
                    <li>Si vous double-cliquez sur une cellule "Nom" et effacez son contenu, un message "Ce champ est requis" apparaîtra sous l'input lors de la tentative de sauvegarde (blur ou Entrée), et la cellule sera marquée avec la classe `field-invalid`. La sauvegarde sera bloquée.</li>
                    <li>Si vous entrez un nom de plus de 20 caractères, le message "Maximum 20 caractères." apparaîtra.</li>
                    <li>Si vous entrez un âge négatif ou décimal, les messages correspondants apparaîtront.</li>
                    <li>Si vous entrez un code qui ne contient pas "CODE-", le message du validateur personnalisé apparaîtra.</li>
                    <li>La validation s'effectue également en temps réel pendant la saisie grâce au hook `afterEdit` qui attache un listener `input`.</li>
                    <li>La sauvegarde n'est autorisée par le hook `beforeSave` que si toutes les règles de validation pour la cellule sont respectées.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>
