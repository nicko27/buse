<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Plugin Sort - TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="../src/tableFlow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles spécifiques à cette page de documentation */
        /* NOTE: Il est préférable de définir les styles TableFlow dans un fichier CSS dédié */
        body { padding: 2rem; }
        .content { margin-left: 0; } /* Pas de nav latérale dans ce doc standalone */
         h1 { margin-bottom: 2rem; }
         /* Style pour la cohérence */
         tr.modified td { background-color: var(--tf-modified-bg, #fffbeb); }

         /* Styles pour Sort (normalement dans tableFlow.css) */
         th.sortable { cursor: pointer; }
         .sort-indicator {
             margin-left: auto; /* Pousse à droite dans flex */
             padding-left: 5px;
             opacity: var(--tf-sort-icon-opacity, 0.5);
             transition: opacity 0.2s ease;
             font-size: 0.9em;
             display: inline-block; /* Assure l'affichage */
             vertical-align: middle; /* Alignement vertical */
         }
         th.sortable:hover .sort-indicator {
             opacity: var(--tf-sort-icon-hover-opacity, 1);
         }
         /* Assure que l'icône va à droite dans un flex container (wrapper) */
         th.sortable .head-wrapper {
             display: flex;
             justify-content: space-between; /* Espace entre texte et icône */
             align-items: center;
             width: 100%;
         }
         /* Style pour le bouton reset de l'exemple */
         #resetSortBtn { margin-top: 1rem; padding: 0.5rem 1rem; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <h1>Documentation Plugin Sort</h1>

            <section id="plugin-sort-intro">
                <h2>Objectif</h2>
                <p>
                    Le plugin <strong>Sort</strong> permet aux utilisateurs de trier les lignes (`&lt;tr&gt;`) d'un tableau TableFlow en cliquant sur les en-têtes (`&lt;th&gt;`) des colonnes.
                </p>
                <p>
                    Fonctionnalités :
                </p>
                <ul>
                    <li>Tri ascendant et descendant au clic sur l'en-tête.</li>
                    <li>Un troisième clic sur le même en-tête réinitialise l'ordre au tri initial du DOM (basé sur l'ordre des lignes au moment de l'initialisation).</li>
                    <li>Affichage d'icônes dans l'en-tête pour indiquer la colonne triée et la direction (ascendant, descendant, neutre).</li>
                    <li>Tri numérique intelligent : utilise `localeCompare` avec l'option `{ numeric: true }`, qui tente de comparer les chaînes comme des nombres lorsque c'est pertinent.</li>
                    <li>Tri textuel respectant la locale du navigateur (grâce à `localeCompare`).</li>
                    <li>Option pour ignorer la casse (`ignoreCase`) lors du tri textuel.</li>
                    <li>Possibilité de définir la valeur de tri via `data-sort-value` sur les `&lt;td&gt;` pour un contrôle fin.</li>
                </ul>
            </section>

            <section id="plugin-sort-activation">
                <h2>Activation et Configuration HTML</h2>
                <p>
                    Pour rendre une colonne triable, ajoutez l'attribut <code class="attr">th-sort</code> (configurable via `sortableAttribute` en JS) à l'élément <code>&lt;th&gt;</code> correspondant. Aucune valeur n'est nécessaire pour cet attribut.
                </p>
                <p>
                    Pour contrôler la valeur utilisée lors du tri (au lieu du contenu textuel de la cellule), ajoutez l'attribut <code class="attr">data-sort-value="..."</code> à chaque cellule `<td>` de cette colonne. Si cet attribut est présent, sa valeur sera utilisée pour la comparaison lors du tri, sinon le plugin utilisera `data-value` (s'il existe) puis le `textContent` de la cellule comme dernière option.
                </p>
                <pre><code class="language-html">&lt;!-- Assurez-vous que la table a un ID unique --&gt;
&lt;table id="maTableSort"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;!-- Colonne triable (texte) --&gt;
      &lt;th id="colNom" th-sort&gt;Nom&lt;/th&gt;
      &lt;!-- Colonne triable (numérique) --&gt;
      &lt;th id="colAge" th-sort&gt;Âge&lt;/th&gt;
      &lt;!-- Colonne triable avec data-sort-value pour date YYYYMMDD --&gt;
      &lt;th id="colDate" th-sort&gt;Date (Affichage JJ/MM/YYYY)&lt;/th&gt;
      &lt;th id="colNonTriable"&gt;Non Triable&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr id="row1"&gt;
        &lt;td id="colNom_row1"&gt;Charlie&lt;/td&gt;
        &lt;td id="colAge_row1"&gt;30&lt;/td&gt;
        &lt;!-- Utiliser data-sort-value pour un format de tri cohérent --&gt;
        &lt;td id="colDate_row1" data-sort-value="20240115"&gt;15/01/2024&lt;/td&gt;
        &lt;td id="colNonTriable_row1"&gt;Info A&lt;/td&gt;
    &lt;/tr&gt;
     &lt;tr id="row2"&gt;
        &lt;td id="colNom_row2"&gt;Alice&lt;/td&gt;
        &lt;td id="colAge_row2"&gt;25&lt;/td&gt;
        &lt;td id="colDate_row2" data-sort-value="20231220"&gt;20/12/2023&lt;/td&gt;
        &lt;td id="colNonTriable_row2"&gt;Info B&lt;/td&gt;
    &lt;/tr&gt;
     &lt;tr id="row3"&gt;
        &lt;td id="colNom_row3"&gt;bob&lt;/td&gt; &lt;!-- Sera trié comme 'bob' ou 'Bob' selon ignoreCase --&gt;
        &lt;td id="colAge_row3"&gt;35&lt;/td&gt;
        &lt;td id="colDate_row3" data-sort-value="20240201"&gt;01/02/2024&lt;/td&gt;
        &lt;td id="colNonTriable_row3"&gt;Info C&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
                <p>
                    Le plugin ajoutera automatiquement un indicateur visuel (par défaut <i class="fas fa-sort"></i>) aux en-têtes triables et la classe CSS `sortable` pour le style du curseur.
                </p>
            </section>

            <section id="plugin-sort-config-js">
                <h2>Configuration JavaScript</h2>
                <p>
                    La configuration du plugin se fait dans l'objet d'options de `TableFlow`, sous la clé <code class="value">plugins.sort</code>.
                </p>
                <pre><code class="language-javascript">// Exemple d'initialisation de TableFlow
import TableFlow from '../src/tableFlow.js'; // Ajustez le chemin

const tableS = new TableFlow({
    tableId: 'maTableSort',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: ['Sort'], // Activer le plugin Sort
        sort: { // Configuration spécifique pour 'Sort'
            // --- Options Générales ---
            // sortableAttribute: 'th-sort', // Défaut
            sortIndicatorClass: 'mon-indicateur-tri', // Classe CSS personnalisée pour le span
            sortableClass: 'colonne-triable', // Classe CSS personnalisée pour le th
            // debug: true, // Logs spécifiques

            // --- Apparence (Icônes) ---
            // Utiliser la structure 'icons' préférée
            icons: {
                asc: '&lt;span aria-hidden="true"&gt;▲&lt;/span&gt;', // Utiliser des caractères simples avec aria-hidden
                desc: '&lt;span aria-hidden="true"&gt;▼&lt;/span&gt;',
                none: '&lt;span aria-hidden="true"&gt;↕&lt;/span&gt;'
            },
            // Les anciennes options iconAsc, iconDesc, iconNone sont toujours supportées
            // pour la compatibilité mais 'icons' est recommandé.

            // --- Comportement du Tri ---
            ignoreCase: false // Rendre le tri textuel sensible à la casse
        }
    }
});
</code></pre>

                <h3>Tableau Complet des Options de Configuration JS (`plugins.sort`)</h3>
                <div class="info-block">
                    Ce tableau liste toutes les options configurables pour le plugin Sort via l'objet `plugins.sort`.
                </div>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option (dans `plugins.sort`)</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">sortableAttribute</code></td><td class="type">string</td><td><code class="default">'th-sort'</code></td><td>Nom de l'attribut HTML sur `<th>` pour activer le tri sur une colonne.</td></tr>
                        <tr><td><code class="attr">sortIndicatorClass</code></td><td class="type">string</td><td><code class="default">'sort-indicator'</code></td><td>Classe CSS appliquée à l'élément `<span>` ajouté dans l'en-tête pour afficher l'icône de tri.</td></tr>
                        <tr><td><code class="attr">sortableClass</code></td><td class="type">string</td><td><code class="default">'sortable'</code></td><td>Classe CSS ajoutée aux éléments `<th>` qui sont triables (utile pour le style, ex: curseur).</td></tr>
                        <tr><td><code class="attr">icons</code></td><td class="type">object</td><td><code class="default">{ asc: '&lt;i class="fas fa-sort-up"&gt;&lt;/i&gt;', desc: '&lt;i class="fas fa-sort-down"&gt;&lt;/i&gt;', none: '&lt;i class="fas fa-sort"&gt;&lt;/i&gt;' }</code></td><td>Objet contenant le code HTML des icônes pour les états de tri : `asc` (ascendant), `desc` (descendant), `none` (neutre/non trié). Assurez-vous que le HTML est sûr ou utilisez le sanitizer.</td></tr>
                        <tr><td><code class="attr">iconAsc</code></td><td class="type">string</td><td><i>(Hérité de `icons.asc`)</i></td><td>(Obsolète) HTML de l'icône ascendante. Utilisez `icons.asc`.</td></tr>
                        <tr><td><code class="attr">iconDesc</code></td><td class="type">string</td><td><i>(Hérité de `icons.desc`)</i></td><td>(Obsolète) HTML de l'icône descendante. Utilisez `icons.desc`.</td></tr>
                        <tr><td><code class="attr">iconNone</code></td><td class="type">string</td><td><i>(Hérité de `icons.none`)</i></td><td>(Obsolète) HTML de l'icône neutre. Utilisez `icons.none`.</td></tr>
                        <tr><td><code class="attr">ignoreCase</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, le tri textuel ignore la différence entre majuscules et minuscules (via l'option `sensitivity: 'base'` de `localeCompare`). Si `false`, utilise `sensitivity: 'variant'`.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage spécifiques au plugin Sort. Hérite du `debug` global si non défini.</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="plugin-sort-how-it-works">
                <h2>Fonctionnement Interne</h2>
                <ul>
                    <li><strong>Initialisation (`init`, `setupSortableColumns`, `setupSortColumn`):</strong>
                        <ul>
                            <li>Ajoute un attribut `data-original-index` à chaque `<tr>` du `<tbody>` (`ensureOriginalOrderStored`) pour pouvoir réinitialiser l'ordre.</li>
                            <li>Identifie les `<th>` avec l'attribut `sortableAttribute`.</li>
                            <li>Pour chaque `<th>` triable :
                                <ul>
                                    <li>Ajoute la classe `sortableClass`.</li>
                                    <li>Crée un `<span>` avec `sortIndicatorClass` et l'icône `none` par défaut, puis l'ajoute à l'en-tête (idéalement dans le wrapper `head-wrapper` si présent). Utilise le sanitizer si disponible pour insérer l'icône HTML.</li>
                                    <li>Ajoute un écouteur d'événement `click` qui appelle `handleHeaderClick`.</li>
                                    <li>Stocke une référence à l'écouteur pour pouvoir le supprimer.</li>
                                    <li>Définit l'état initial `data-sort-direction="none"` et `aria-sort="none"`.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Clic sur En-tête (`handleHeaderClick`):</strong>
                        <ul>
                            <li>Détermine la nouvelle direction de tri (cycle: none -> asc -> desc -> none, en commençant par 'asc' si on change de colonne).</li>
                            <li>Réinitialise l'indicateur et l'état (`data-sort-direction`, `aria-sort`) de <strong>tous les autres</strong> en-têtes triables à 'none'.</li>
                            <li>Met à jour l'indicateur et l'état de l'en-tête cliqué avec la nouvelle direction.</li>
                            <li>Met à jour l'état interne (`currentSortHeader`, `currentSortDirection`).</li>
                            <li>Si la nouvelle direction est 'none', appelle `resetSort()`.</li>
                            <li>Sinon, appelle `sortColumn(columnIndex, newDirection)`.</li>
                            <li>Déclenche l'événement `sortAppened` pour notifier les autres plugins (ex: FilterAndPaginate).</li>
                        </ul>
                    </li>
                    <li><strong>Tri (`sortColumn`):</strong>
                        <ul>
                            <li>Récupère toutes les lignes du `<tbody>` via `Array.from(tbody.rows)`.</li>
                            <li>Trie ce tableau de lignes en utilisant `Array.prototype.sort()` et une fonction `compareRows`.</li>
                            <li>La fonction `compareRows` :
                                <ul>
                                    <li>Récupère les cellules `<td>` correspondantes dans les deux lignes à comparer.</li>
                                    <li>Extrait la valeur de tri pour chaque cellule (priorité: `data-sort-value` > `data-value` > `textContent`).</li>
                                    <li>Utilise `String.prototype.localeCompare(otherString, locales, options)` avec `options = { numeric: true, sensitivity: ... }`. Cette méthode gère nativement la comparaison de chaînes qui représentent des nombres et respecte la locale pour l'ordre alphabétique et la sensibilité à la casse (selon `config.ignoreCase`).</li>
                                    <li>Applique le multiplicateur `direction` (`1` pour 'asc', `-1` pour 'desc') au résultat de `localeCompare`.</li>
                                </ul>
                            </li>
                            <li>Réinsère les lignes triées dans le `<tbody>` en utilisant un `DocumentFragment` pour la performance.</li>
                        </ul>
                    </li>
                    <li><strong>Réinitialisation (`resetSort`):</strong>
                        <ul>
                            <li>Récupère toutes les lignes du `<tbody>`.</li>
                            <li>Trie les lignes en fonction de leur attribut `data-original-index`.</li>
                            <li>Réinsère les lignes triées dans le `<tbody>`.</li>
                            <li>Réinitialise l'état et l'indicateur de tous les en-têtes à 'none'.</li>
                            <li>Réinitialise l'état interne (`currentSortHeader`, `currentSortDirection`).</li>
                        </ul>
                    </li>
                     <li><strong>Rafraîchissement (`refresh`):</strong> Ré-exécute `setupSortableColumns()` après avoir nettoyé la configuration précédente (`removeSortConfiguration`). Réapplique l'état de tri visuel s'il y en avait un.</li>
                     <li><strong>Nettoyage (`destroy`):</strong> Appelle `removeSortConfiguration()` pour supprimer les indicateurs, les classes et les écouteurs de clic des en-têtes. Vide les structures de données internes.</li>
                </ul>
            </section>

            <section id="plugin-sort-api">
                 <h2>API Publique</h2>
                 <p>Le plugin Sort n'expose pas de méthodes publiques spécifiques dans cette version, à l'exception de `resetSort()` qui peut être utile.</p>
                 <pre><code class="language-javascript">// Après initialisation de TableFlow et attente de ready()
const sortPlugin = myTableFlowInstance.getPlugin('sort');
sortPlugin?.resetSort(); // Réinitialise l'ordre des lignes
</code></pre>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Méthode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr>
                             <td><code>resetSort()</code></td>
                             <td>-</td>
                             <td>Réinitialise l'ordre des lignes à celui d'origine (basé sur l'ordre du DOM lors de l'initialisation) et réinitialise l'état visuel des indicateurs de tri.</td>
                             <td class="type">void</td>
                         </tr>
                     </tbody>
                 </table>
                 <p>Pour déclencher un tri par programmation, vous pourriez simuler un événement de clic sur l'en-tête désiré, ou potentiellement étendre le plugin pour ajouter une méthode `sortBy(columnIndex, direction)`.</p>
            </section>

            <section id="plugin-sort-events">
                <h2>Événements</h2>
                <ul>
                    <li><strong>Écoutés :</strong>
                        <ul>
                            <li><code>click</code> (sur les `<th>` triables) : Pour déclencher le tri.</li>
                        </ul>
                    </li>
                    <li><strong>Déclenchés :</strong>
                        <ul>
                            <li><code>sortAppened</code> (sur l'élément `<table>`) : Déclenché après qu'un tri (ou une réinitialisation) a été appliqué. Contient `{ detail: { columnId, columnIndex, direction, tableId } }`. Utile pour que d'autres plugins (comme FilterAndPaginate) se mettent à jour.</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <section id="plugin-sort-example">
                <h2>Exemple Complet</h2>
                <p>Cet exemple montre une table avec plusieurs colonnes triables, y compris une colonne de date utilisant `data-sort-value` pour un tri chronologique correct et une colonne numérique.</p>

                <strong>HTML (`index.html`):</strong>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Exemple Sort Plugin&lt;/title&gt;
    &lt;link rel="stylesheet" href="../src/tableFlow.css"&gt;
    &lt;link rel="stylesheet" href="documentation.css"&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"&gt;
    &lt;style&gt;
        body { padding: 2rem; font-family: sans-serif; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        thead th { background-color: #f2f2f2; }
        /* Styles Sort (normalement dans tableFlow.css) */
        th.sortable { cursor: pointer; }
        .sort-indicator { margin-left: auto; padding-left: 5px; opacity: 0.5; transition: opacity 0.2s ease; font-size: 0.9em; display: inline-block; vertical-align: middle;}
        th.sortable:hover .sort-indicator { opacity: 1; }
        th.sortable .head-wrapper { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        #resetSortBtn { margin-top: 1rem; padding: 0.5rem 1rem; cursor: pointer; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;TableFlow - Exemple Plugin Sort&lt;/h1&gt;
    &lt;p&gt;Cliquez sur les en-têtes "Nom", "Score" ou "Date d'ajout" pour trier.&lt;/p&gt;

    &lt;table id="sortTableExample"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th id="sNom" th-sort&gt;Nom&lt;/th&gt;
                &lt;th id="sScore" th-sort&gt;Score&lt;/th&gt;
                &lt;th id="sDate" th-sort&gt;Date d'ajout&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr id="s_r1"&gt; &lt;!-- data-original-index sera ajouté par le plugin --&gt;
                &lt;td id="sNom_r1"&gt;Charlie&lt;/td&gt;
                &lt;td id="sScore_r1"&gt;85&lt;/td&gt;
                &lt;td id="sDate_r1" data-sort-value="20240210"&gt;10 Fév 2024&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="s_r2"&gt;
                &lt;td id="sNom_r2"&gt;Alice&lt;/td&gt;
                &lt;td id="sScore_r2"&gt;92&lt;/td&gt;
                &lt;td id="sDate_r2" data-sort-value="20240105"&gt;05 Jan 2024&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr id="s_r3"&gt;
                &lt;td id="sNom_r3"&gt;Bob&lt;/td&gt;
                &lt;td id="sScore_r3"&gt;85&lt;/td&gt;
                &lt;td id="sDate_r3" data-sort-value="20240215"&gt;15 Fév 2024&lt;/td&gt;
            &lt;/tr&gt;
             &lt;tr id="s_r4"&gt;
                &lt;td id="sNom_r4"&gt;alice&lt;/td&gt; &lt;!-- Casse différente --&gt;
                &lt;td id="sScore_r4"&gt;105&lt;/td&gt;
                &lt;td id="sDate_r4" data-sort-value="20231225"&gt;25 Déc 2023&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;button id="resetSortBtn"&gt;Réinitialiser le tri&lt;/button&gt;

    &lt;script type="module"&gt;
        import TableFlow from '../src/tableFlow.js'; // Ajustez le chemin

        const sortTable = new TableFlow({
            tableId: 'sortTableExample',
            pluginsPath: '../plugins', // Ajustez
            debug: true,
            plugins: {
                names: ['Sort'], // Activer le plugin Sort
                sort: {
                    ignoreCase: true, // Tri insensible à la casse (défaut)
                    // Utiliser les icônes FontAwesome par défaut
                }
            }
        });

        // Fonction pour le bouton reset
        window.resetSort = async () => {
            await sortTable.ready(); // Attendre que l'instance soit prête
            const sortPlugin = sortTable.getPlugin('sort');
            sortPlugin?.resetSort(); // Appeler la méthode du plugin
        };
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

                <strong>Fonctionnement de l'exemple :</strong>
                <ol>
                    <li>La table s'affiche avec les colonnes "Nom", "Score", et "Date d'ajout" triables.</li>
                    <li>Cliquez sur "Nom" : tri alphabétique insensible à la casse (Alice, alice, Bob, Charlie). Icône ▲.</li>
                    <li>Cliquez encore sur "Nom" : ordre inversé (Charlie, Bob, alice, Alice). Icône ▼.</li>
                    <li>Cliquez une troisième fois : retour à l'ordre initial. Icône ↕.</li>
                    <li>Cliquez sur "Score" : tri numérique (Bob 85, Charlie 85, Alice 92, alice 105). Icône ▲.</li>
                    <li>Cliquez sur "Date d'ajout" : tri chronologique basé sur `data-sort-value` (alice 20231225, Alice 20240105, Charlie 20240210, Bob 20240215). Icône ▲.</li>
                    <li>Cliquer sur "Réinitialiser le tri" remet la table dans son ordre initial.</li>
                </ol>
            </section>

        </div>
    </div>
</body>
</html>
