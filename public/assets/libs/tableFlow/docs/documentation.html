<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Exhaustive TableFlow</title>
    <link rel="stylesheet" href="documentation.css">
    <link rel="stylesheet" href="../src/tableFlow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Styles spécifiques pour les exemples dans cette page */
        #exempleTableTaches tr.modified td,
        #exempleTableProduits tr.modified td { background-color: var(--tf-modified-bg, #fffbeb); }
        #exempleTableTaches tr.dim { opacity: 0.6; }
        #exempleTableTaches tr.error-row td { background-color: var(--tf-invalid-bg, #fee2e2) !important; }
        #exempleTableProduits .tf-highlight-span[data-group="urgent"] { background-color: pink; color: red; }
        #exempleTableProduits .tf-highlight-span[data-group="promo"] { background-color: green; color: white; }
        #exempleTableProduits td.invalid { background-color: var(--tf-invalid-bg, #fee2e2) !important; outline: 1px solid var(--tf-invalid-border, #fca5a5); }
        #exempleTableProduits .validation-error { color: var(--tf-error-text-color, #991b1b); font-size: 0.8em; margin-top: 4px; display: none; }
        #exempleTableProduits td.invalid .validation-error { display: block; }
        #exempleTableProduits .tf-color-wrapper { display: flex; align-items: center; gap: 5px; }
        #exempleTableProduits .tf-color-preview { width: var(--tf-color-preview-size, 20px); height: var(--tf-color-preview-size, 20px); border: 1px solid var(--tf-border-color, #ccc); border-radius: var(--tf-border-radius, 4px); cursor: pointer; }
        #exempleTableProduits .tf-color-input { width: var(--tf-color-input-width, 80px); text-align: center; border: 1px solid var(--tf-border-color, #ccc); border-radius: var(--tf-border-radius, 4px); padding: 3px 5px; font-size: inherit; }
        #exempleTableTaches th.reorderable-column,
        #exempleTableProduits th.reorderable-column { position: relative; cursor: grab; }
        #exempleTableTaches .column-drag-handle,
        #exempleTableProduits .column-drag-handle { cursor: grab; color: var(--tf-reorder-handle-color, #999); padding: 0 5px; }
        #filterProduits, #filterTaches { margin-bottom: 1em; padding: 0.5em; border: 1px solid var(--tf-border-color, #ccc); border-radius: var(--tf-border-radius, 4px); }
        .pagination-container { margin-top: 1em; }
        /* Styles pour les boutons de pagination (exemple simple) */
        .tf-page-button { padding: 0.3rem 0.6rem; border: 1px solid var(--tf-primary-color, #4f46e5); background-color: transparent; color: var(--tf-primary-color, #4f46e5); border-radius: 4px; cursor: pointer; margin: 0 2px; }
        .tf-page-button.active { background-color: var(--tf-primary-color, #4f46e5); color: white; }
        .tf-page-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .tf-pagesize-select { padding: 0.3rem; border: 1px solid var(--tf-border-color, #ccc); border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <h3>TableFlow</h3>
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#initialisation">Initialisation</a></li>
                <li><a href="#core-concepts">Concepts Clés</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#core-api">API Principale</a></li>
                <li><a href="#plugins-overview">Plugins Disponibles</a>
                    <ul>
                        <li><a href="actions.html">Actions</a></li>
                        <li><a href="choice.html">Choice</a></li>
                        <li><a href="color.html">Color</a></li>
                        <li><a href="columnreorder.html">ColumnReorder</a></li>
                        <li><a href="contextmenu.html">ContextMenu</a></li>
                        <li><a href="edit.html">Edit</a></li>
                        <li><a href="filterandpaginate.html">Filter & Paginate</a></li>
                        <li><a href="highlight.html">Highlight</a></li>
                        <li><a href="hide.html">Hide</a></li>
                        <li><a href="linetoggle.html">LineToggle</a></li>
                        <li><a href="selection.html">Selection</a></li>
                        <li><a href="sort.html">Sort</a></li>
                        <li><a href="texteditor.html">TextEditor</a></li>
                        <li><a href="validation.html">Validation</a></li>
                        </ul>
                </li>
                <li><a href="#exemples-complets">Exemples Complets</a>
                    <ul>
                        <li><a href="#exemple-gestion-taches">Gestion de Tâches</a></li>
                        <li><a href="#exemple-catalogue-produits">Catalogue Produits</a></li>
                    </ul>
                </li>
                 <li><a href="#personnalisation">Personnalisation</a></li>
                 <li><a href="#contribution">Contribution</a></li>
            </ul>
        </nav>

        <div class="content">
            <h1>Documentation TableFlow</h1>

            <section id="introduction">
                <h2>Introduction</h2>
                <p>
                    TableFlow est une bibliothèque JavaScript modulaire conçue pour transformer des tableaux HTML standard (<code>&lt;table&gt;</code>)
                    en composants interactifs et riches en fonctionnalités. Son objectif principal est de fournir une base
                    extensible pour manipuler et interagir avec des données tabulaires directement dans le navigateur,
                    en minimisant le besoin de code JavaScript complexe côté utilisateur pour des tâches courantes.
                </p>
                <p>
                    Grâce à son système de plugins, vous pouvez ajouter sélectivement des capacités telles que l'édition en ligne, la validation, le tri, le filtrage, la pagination, les actions personnalisées, la sélection de valeurs, la réorganisation des colonnes, le surlignage de texte, et bien plus encore.
                </p>
                 <p>
                    L'approche de TableFlow est souvent déclarative : de nombreuses fonctionnalités sont activées et
                    configurées via des attributs HTML spécifiques placés sur les éléments <code>&lt;th&gt;</code>
                    de votre tableau, complétés par une configuration JavaScript pour les options plus complexes
                    et la logique métier (comme les handlers d'action).
                </p>
                <p>
                    L'architecture utilise un gestionnaire d'instances (`instanceManager`) pour potentiellement gérer plusieurs tables sur une même page, chaque table étant représentée par une `TableInstance`.
                </p>
            </section>

            <section id="installation">
                <h2>Installation</h2>
                <p>
                    TableFlow utilise les modules ES6. Assurez-vous d'inclure les fichiers nécessaires dans votre projet.
                </p>
                <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;TableFlow Setup&lt;/title&gt;

    &lt;!-- 1. CSS de base TableFlow (requis) --&gt;
    &lt;link rel="stylesheet" href="path/to/tableflow/src/tableFlow.css"&gt;

    &lt;!-- 2. CSS de la documentation ou votre thème personnalisé (optionnel) --&gt;
    &lt;link rel="stylesheet" href="path/to/tableflow/docs/documentation.css"&gt;
    &lt;!-- Ou: &lt;link rel="stylesheet" href="votre_theme.css"&gt; --&gt;

    &lt;!-- 3. FontAwesome (Optionnel, pour les icônes par défaut de certains plugins) --&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"&gt;

    &lt;!-- 4. Dépendances externes spécifiques aux plugins (Ex: ColorFlow pour le plugin Color) --&gt;
    &lt;!-- &lt;script src="path/to/colorFlow.js"&gt;&lt;/script&gt; --&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;!-- 5. Votre table HTML avec un ID unique et des attributs th-* pour activer les plugins --&gt;
    &lt;table id="maSuperTable"&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th id="col1" th-sort&gt;Colonne Triable&lt;/th&gt;
          &lt;th id="col2" th-edit th-validate='{"required":true}'&gt;Colonne Éditable&lt;/th&gt;
          &lt;th id="col3" th-choice='{"type":"toggle", "values":["A","B"]}'&gt;Choix&lt;/th&gt; &lt;!-- Config JSON préférée --&gt;
          &lt;th id="col4" th-actions="save,delete"&gt;Actions&lt;/th&gt;
          &lt;th id="col5" th-hide&gt;Cachée&lt;/th&gt;
          &lt;!-- ... --&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
          &lt;!-- Données initiales de la table --&gt;
          &lt;tr id="r1"&gt;
              &lt;td id="col1_r1"&gt;Zebra&lt;/td&gt;
              &lt;td id="col2_r1"&gt;Texte initial&lt;/td&gt;
              &lt;td id="col3_r1" data-value="A"&gt;A&lt;/td&gt;
              &lt;td id="col4_r1"&gt;&lt;/td&gt; &lt;!-- Sera peuplé par Actions --&gt;
              &lt;td id="col5_r1"&gt;secret&lt;/td&gt;
          &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;!-- 6. Initialisation via un script de type module --&gt;
    &lt;script type="module"&gt;
      // Importe la classe TableFlow principale
      import TableFlow from './path/to/tableflow/src/tableFlow.js'; // Ajustez le chemin

      // Options de configuration pour cette table
      const tableOptions = {
        tableId: 'maSuperTable',          // ID de la table HTML
        pluginsPath: './path/to/tableflow/plugins', // Chemin vers le dossier des plugins JS
        debug: true,                     // Activer les logs de débogage
        plugins: {
            // Noms des plugins à activer pour cette table
            names: ['Sort', 'Edit', 'Validation', 'Choice', 'Actions', 'Hide'],
            // Configuration spécifique pour chaque plugin (optionnel)
            sort: {
                ignoreCase: true
            },
            choice: {
                // La config pour col3 est déjà dans l'attribut th-choice,
                // mais on pourrait la définir ou la surcharger ici si besoin.
                // columns: {
                //     'col3': { type: 'toggle', values: ['A', 'B', 'C'] }
                // }
            },
            actions: {
                actions: { // Définition des handlers
                    'save': {
                        handler: (context) => {
                            console.log('Sauvegarde demandée:', context.data);
                            context.tableHandler.markRowAsSaved(context.row); // Utilise l'API TableInstance
                        },
                        showOnChange: true // Afficher seulement si modifié
                    },
                    'delete': {
                        handler: (context) => {
                            if (confirm('Supprimer cette ligne ?')) {
                                console.log('Suppression demandée:', context.row.id);
                                context.tableHandler.removeRow(context.row); // Utilise l'API TableInstance
                            }
                        }
                    }
                },
                icons: { // Icônes FontAwesome par défaut
                    'save': '&lt;i class="fas fa-save" style="color: green; cursor: pointer;"&gt;&lt;/i&gt;',
                    'delete': '&lt;i class="fas fa-trash-alt" style="color: red; cursor: pointer;"&gt;&lt;/i&gt;'
                }
            }
            // Pas de config JS nécessaire pour Hide, Edit, Validation, Sort si les attributs suffisent
        }
      };

      // Initialiser TableFlow pour cette table
      try {
          const maTableInstance = new TableFlow(tableOptions);
          console.log('TableFlow initialisé avec succès pour maSuperTable !');
          // Vous pouvez maintenant utiliser maTableInstance pour interagir avec la table via l'API
          // Exemple: maTableInstance.addRow({ col1: 'Nouvel Item', col2: 'Description', col3: 'B' });
      } catch (error) {
          console.error("Erreur lors de l'initialisation de TableFlow:", error);
          // Gérer l'erreur (ex: afficher un message à l'utilisateur)
      }
    &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
                 <div class="info-block">
                    <strong>Important :</strong> Le chemin `pluginsPath` est relatif à l'emplacement où le navigateur exécute le script module (généralement votre fichier JS principal), et non relatif à `tableFlow.js` lui-même. Assurez-vous que les fichiers JS des plugins sont accessibles depuis cette localisation. L'attribut `type="module"` sur la balise script est essentiel.
                </div>
            </section>

            <section id="initialisation">
                <h2>Initialisation</h2>
                <p>
                    L'initialisation se fait en créant une instance de la classe `TableFlow` et en lui passant un objet d'options. L'option la plus importante est `tableId`, qui identifie l'élément `<table>` HTML à améliorer.
                </p>
                <pre><code class="language-javascript">// Importation
import TableFlow from './path/to/tableflow/src/tableFlow.js';

// Options minimales
const optionsMinimales = {
    tableId: 'maTableHtml'
    // Les plugins peuvent être activés via les attributs th-*
};
const tableSimple = new TableFlow(optionsMinimales);

// Options plus complètes avec plugins et configuration
const optionsCompletes = {
    tableId: 'maTableComplexe',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: ['Sort', 'Edit', 'Actions'], // Activer ces plugins
        sort: { ignoreCase: true },         // Configurer Sort
        actions: {                          // Configurer Actions
            actions: { /* ... handlers ... */ },
            icons: { /* ... icônes ... */ }
        }
        // Edit utilisera l'attribut th-edit
    }
};
const tableComplexe = new TableFlow(optionsCompletes);

// Attendre que l'initialisation soit terminée (chargement des plugins)
tableComplexe.ready().then(instance => {
    console.log(`TableFlow pour ${instance.tableId} est prête !`);
    // Vous pouvez maintenant utiliser l'API en toute sécurité
    // instance.addRow({...});
}).catch(error => {
    console.error("Échec de l'initialisation de TableFlow:", error);
});
</code></pre>
                <h3>Options d'Initialisation Principales (`new TableFlow(options)`)</h3>
                <p>Ces options contrôlent le comportement global de l'instance TableFlow.</p>
                <table class="documentation-table">
                    <thead>
                        <tr><th>Option</th><th>Type</th><th>Défaut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code class="attr">tableId</code></td><td class="type">string</td><td><i>Requis</i></td><td>ID de l'élément <code>&lt;table&gt;</code> HTML à cibler.</td></tr>
                        <tr><td><code class="attr">plugins</code></td><td class="type">object</td><td><code>{names:[]}</code></td><td>Objet pour configurer les plugins : <code>{ names: ['Plugin1', 'Plugin2'], plugin1: { /* config */ }, plugin2: { /* config */ } }</code>. La clé `names` est un tableau des noms de plugins à charger. Les autres clés (nom du plugin en minuscules) contiennent la configuration spécifique à chaque plugin.</td></tr>
                        <tr><td><code class="attr">pluginsPath</code></td><td class="type">string</td><td><code>'../plugins'</code></td><td>Chemin relatif (depuis le script qui importe TableFlow) vers le dossier contenant les fichiers <code>.js</code> des plugins.</td></tr>
                        <tr><td><code class="attr">debug</code></td><td class="type">boolean</td><td><code class="default">false</code></td><td>Active les logs de débogage détaillés pour TableFlow et les plugins (peut être surchargé par la config de chaque plugin).</td></tr>
                        <tr><td><code class="attr">verbosity</code></td><td class="type">number</td><td><code class="default">0</code></td><td>Niveau de détail des logs (0: erreurs, 1: +succès/warnings, 2: +debug). `debug: true` équivaut à `verbosity: 2`.</td></tr>
                        <tr><td><code class="attr">notifications</code></td><td class="type">object</td><td><code>{}</code></td><td>Permet de brancher un système de notification externe (ex: toasts). Doit fournir des fonctions pour `info`, `warning`, `success`, `error`. Ex: `{ error: (msg) => myToastLib.error(msg) }`.</td></tr>
                        <tr><td><code class="attr">wrapCellsEnabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, le contenu de chaque `<td>` sera automatiquement enveloppé dans un `<div>` avec la classe `wrapCellClass`. Recommandé pour la plupart des plugins.</td></tr>
                        <tr><td><code class="attr">wrapHeadersEnabled</code></td><td class="type">boolean</td><td><code class="default">true</code></td><td>Si `true`, le contenu de chaque `<th>` sera automatiquement enveloppé dans un `<div>` avec la classe `wrapHeaderClass`. Recommandé pour les plugins ajoutant des indicateurs (Sort) ou des poignées (ColumnReorder).</td></tr>
                        <tr><td><code class="attr">wrapCellClass</code></td><td class="type">string</td><td><code class="default">'cell-wrapper'</code></td><td>Classe CSS appliquée au wrapper des cellules `<td>`.</td></tr>
                        <tr><td><code class="attr">wrapHeaderClass</code></td><td class="type">string</td><td><code class="default">'head-wrapper'</code></td><td>Classe CSS appliquée au wrapper des en-têtes `<th>`.</td></tr>
                        <tr><td><code class="attr">logger</code></td><td class="type">object</td><td><code>console</code></td><td>Permet de fournir une instance de logger personnalisée (doit implémenter `debug`, `info`, `warn`, `error`, `success`).</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="core-concepts">
                <h2>Concepts Clés Détaillés</h2>
                <ul>
                    <li>
                        <strong>Architecture Modulaire (`instanceManager`, `TableInstance`, Plugins) :</strong> TableFlow utilise un `instanceManager` pour gérer potentiellement plusieurs tables. Chaque table est une `TableInstance` qui charge et gère ses propres plugins. Les fonctionnalités (tri, édition, etc.) sont encapsulées dans des plugins JS indépendants. Vous activez les plugins nécessaires via `plugins.names`.
                    </li>
                    <li>
                        <strong>Configuration Déclarative (Attributs `th-*`) :</strong> Activez et configurez simplement les plugins au niveau des colonnes via des attributs HTML sur les `<th>` (ex: `th-sort`, `th-edit`, `th-actions="save,delete"`).
                    </li>
                    <li>
                        <strong>Configuration Programmatique (Options JS) :</strong> Complétez ou surchargez la configuration HTML via l'objet `plugins` dans les options `TableFlow` pour les réglages fins, les listes d'options dynamiques, ou les handlers d'actions.
                    </li>
                    <li>
                        <strong>Gestion de l'État (`data-*`, classe `modified`) :</strong>
                        <ul>
                            <li><code>data-initial-value</code>: Stocke la valeur "propre" d'une cellule (au chargement ou après sauvegarde).</li>
                            <li><code>data-value</code>: Stocke la valeur sémantique *actuelle* (utilisée par les plugins).</li>
                            <li>Classe `modified`: Appliquée à `<tr>` si `data-value` diffère de `data-initial-value` pour au moins une cellule.</li>
                        </ul>
                    </li>
                     <li>
                        <strong>Wrappers (`cell-wrapper`, `head-wrapper`) :</strong> `<div>` optionnels ajoutés autour du contenu des `<td>` et `<th>` (activés par défaut). Essentiels pour que les plugins puissent manipuler le contenu ou ajouter des éléments (icônes, inputs) sans casser la structure.
                    </li>
                    <li>
                        <strong>Système d'Événements (DOM Personnalisés) :</strong> Les plugins communiquent entre eux et avec l'application externe via des événements émis sur l'élément `<table>` (ex: `cell:change`, `row:saved`, `sortAppened`).
                    </li>
                    <li>
                        <strong>API Core (`TableFlow` instance) :</strong> Fournit des méthodes pour interagir avec la table gérée par son `TableInstance` (ex: `addRow`, `removeRow`, `getPlugin`, `markRowAsSaved`). Utilisez `instance.ready()` pour attendre l'initialisation.
                    </li>
                     <li>
                        <strong>Sanitization (`DOMSanitizer`) :</strong> Un utilitaire interne (potentiellement accessible via `tableInstance.sanitizer`) est utilisé pour nettoyer le HTML inséré (ex: icônes, labels) afin de prévenir les attaques XSS.
                    </li>
                </ul>
            </section>

             <section id="architecture">
                <h2>Architecture Détaillée</h2>
                <p>L'architecture repose sur l'interaction entre `TableFlow`, `instanceManager`, `TableInstance`, `InstancePluginManager`, et `PluginRegistry`.</p>
                <ol>
                    <li><strong>`TableFlow` (`src/tableFlow.js`):</strong> Classe publique principale. Agit comme une façade. Son constructeur reçoit les options, configure un logger, et appelle `instanceManager.createInstance`. Elle expose l'API publique qui délègue généralement les appels à la `TableInstance` sous-jacente après avoir vérifié que l'initialisation est terminée (via la promesse `_initializationPromise`).</li>
                    <li><strong>`instanceManager` (`src/instanceManager.js`):</strong> Singleton exporté. Gère un `Map` de toutes les `TableInstance` actives sur la page, indexées par leur `tableId`. Empêche la création de multiples instances pour la même table. Fournit `createInstance`, `getInstance`, `hasInstance`, `destroyInstance`, `destroyAll`.</li>
                    <li><strong>`TableInstance` (classe dans `src/instanceManager.js`):</strong> Représentation interne d'une table gérée. Créée par `instanceManager`. Contient la référence à l'élément `<table>` (`element`), la configuration fusionnée (`config`), son propre `InstancePluginManager`, et potentiellement l'API de manipulation du tableau (`getRowData`, `addRow`, etc.). Sa méthode `init()` orchestre `setupTable()` (wrappers) et `initPlugins()`.</li>
                    <li><strong>`InstancePluginManager` (`src/instancePluginManager.js`):</strong> Chaque `TableInstance` en possède un. Gère le cycle de vie (chargement via `pluginRegistry`, instanciation, `init`, `destroy`, `refresh`) des plugins *pour cette instance spécifique*. Gère les dépendances entre plugins lors de l'activation.</li>
                    <li><strong>`pluginRegistry` (`src/pluginRegistry.js`):</strong> Singleton exporté. Catalogue central des *définitions* de plugins (classes ou objets). Gère le chargement asynchrone (`import()`) des fichiers de plugins via sa méthode `load()`, en évitant les chargements multiples. Valide l'interface de base des plugins lors de l'enregistrement.</li>
                    <li><strong>Plugins (`plugins/*.js`):</strong> Modules JS exportant une classe (ou un objet) par défaut respectant l'interface `PluginDefinition` (propriétés `name`, `version`, `type`, `dependencies`, méthodes `init`, `destroy`, `refresh` optionnel). Reçoivent l'instance `TableInstance` dans leur méthode `init()`.</li>
                     <li><strong>`DOMSanitizer` (`src/domSanitizer.js`):</strong> Classe utilitaire statique fournissant des méthodes pour nettoyer le HTML (`sanitizeHTML`, `setHTML`) et échapper le texte (`escapeHTML`). Peut être rendue accessible aux plugins via `tableInstance.sanitizer`.</li>
                     <li><strong>`types.js` (`src/types.js`):</strong> Fichier définissant les types JSDoc partagés (ex: `PluginType`, `TableFlowConfig`, `TableInstance`, `PluginContext`).</li>
                </ol>
                 <div class="info-block">
                    <strong>Flux d'Initialisation :</strong>
                    <ol>
                        <li>`new TableFlow(options)`</li>
                        <li>`TableFlow` appelle `instanceManager.createInstance(tableId, options)`.</li>
                        <li>`instanceManager` crée `new TableInstance(tableId, options)`.</li>
                        <li>`TableInstance.init()` est appelé.</li>
                        <li>`TableInstance.setupTable()` configure les wrappers.</li>
                        <li>`TableInstance.initPlugins()` appelle `instance.pluginManager.activate(pluginName, pluginConfig)` pour chaque plugin dans `options.plugins.names`.</li>
                        <li>`InstancePluginManager.activate()` appelle `pluginRegistry.load(pluginName, pluginUrl)` pour obtenir la définition du plugin (chargement via `import()` si nécessaire).</li>
                        <li>`PluginRegistry.load()` retourne la classe/objet du plugin.</li>
                        <li>`InstancePluginManager` vérifie les dépendances, fusionne la config, instancie le plugin (`new PluginClass(config)`), et appelle `pluginInstance.init(tableInstance)`.</li>
                        <li>Le plugin s'initialise, s'enregistre aux hooks/providers nécessaires, et attache ses écouteurs.</li>
                        <li>La promesse `createInstance` résout avec la `TableInstance`.</li>
                        <li>La promesse `TableFlow._initializationPromise` résout.</li>
                    </ol>
                </div>
            </section>

            <section id="core-api">
                 <h2>API Principale (Méthodes de l'instance <code>TableFlow</code>)</h2>
                 <p>Après avoir obtenu une instance via `const myTable = new TableFlow(...)`, vous pouvez utiliser les méthodes suivantes. Utilisez `await myTable.ready()` pour vous assurer que l'initialisation est terminée avant d'appeler ces méthodes.</p>
                 <table class="documentation-table">
                     <thead>
                         <tr><th>Méthode</th><th>Arguments</th><th>Description</th><th>Retour</th></tr>
                     </thead>
                     <tbody>
                         <tr><td><code>ready()</code></td><td>-</td><td>Retourne une promesse qui résout lorsque l'instance TableFlow et ses plugins sont initialisés.</td><td class="type">Promise&lt;TableFlow&gt;</td></tr>
                         <tr><td><code>getPlugin(name)</code></td><td><code class="attr">name</code> <span class="type">(string)</span></td><td>Retourne l'instance d'un plugin actif (par son nom, insensible à la casse), permettant d'appeler ses méthodes publiques spécifiques. Retourne `null` si le plugin n'est pas actif ou si l'initialisation a échoué.</td><td class="type">object | null</td></tr>
                         <tr><td><code>refreshPlugins()</code></td><td>-</td><td>Appelle la méthode `refresh()` (si elle existe) sur tous les plugins actifs de l'instance associée.</td><td class="type">Promise&lt;void&gt;</td></tr>
                         <tr><td><code>markRowAsSaved(row, options)</code></td><td><code class="attr">row</code> <span class="type">(HTMLTableRowElement)</span>, <code class="attr">options</code> <span class="type">(object, optionnel)</span></td><td>Marque une ligne comme sauvegardée (met à jour `data-initial-value`, retire classe `modified`, déclenche `row:saved`). Délègue à `TableInstance`.</td><td class="type">void</td></tr>
                         <tr><td><code>addRow(data, position)</code></td><td><code class="attr">data</code> <span class="type">(Array|Object, optionnel)</span>, <code class="attr">position</code> <span class="type">(string, 'start'|'end')</span></td><td>Ajoute une nouvelle ligne au tableau. Délègue à `TableInstance`.</td><td class="type">HTMLTableRowElement | null</td></tr>
                         <tr><td><code>removeRow(rowOrId)</code></td><td><code class="attr">rowOrId</code> <span class="type">(HTMLTableRowElement | string ID)</span></td><td>Supprime une ligne du tableau. Délègue à `TableInstance`.</td><td class="type">boolean</td></tr>
                         <tr><td><code>getRowData(rowOrId)</code></td><td><code class="attr">rowOrId</code> <span class="type">(HTMLTableRowElement | string ID)</span></td><td>Récupère les données d'une ligne sous forme d'objet `{ columnId: value }`. Délègue à `TableInstance`.</td><td class="type">object | null</td></tr>
                         <tr><td><code>getAllRows()</code></td><td>-</td><td>Retourne un tableau de tous les éléments `&lt;tr&gt;` du `&lt;tbody&gt;`. Délègue à `TableInstance`.</td><td class="type">Array&lt;HTMLTableRowElement&gt;</td></tr>
                         <tr><td><code>getVisibleRows()</code></td><td>-</td><td>Retourne un tableau des `&lt;tr&gt;` du `tbody` actuellement visibles (prend en compte le filtrage/pagination). Délègue à `TableInstance`.</td><td class="type">Array&lt;HTMLTableRowElement&gt;</td></tr>
                         <tr><td><code>destroy()</code></td><td>-</td><td>Nettoie l'instance TableFlow et appelle `instanceManager.destroyInstance` pour nettoyer l'instance de table associée et ses plugins.</td><td class="type">Promise&lt;void&gt;</td></tr>
                         <tr><td><code>notify(type, message)</code></td><td><code class="attr">type</code> <span class="type">(string)</span>, <code class="attr">message</code> <span class="type">(string)</span></td><td>Affiche une notification en utilisant le système configuré dans les options `notifications`.</td><td class="type">void</td></tr>
                         </tbody>
                 </table>
                 <div class="info-block">
                    <strong>Accès à `TableInstance` :</strong> Si vous avez besoin d'accéder directement à l'instance `TableInstance` sous-jacente (par exemple, pour des méthodes non exposées par la façade `TableFlow`), vous pouvez utiliser `myTable.tableInstance` après que la promesse `myTable.ready()` soit résolue. Cependant, il est généralement préférable d'utiliser l'API publique de `TableFlow`.
                 </div>
             </section>

            <section id="plugins-overview">
                <h2>Plugins Disponibles (Synthèse)</h2>
                <p>Cliquez sur le nom pour accéder à la documentation détaillée du plugin.</p>
                <ul>
                    <li><a href="actions.html">Actions</a>: Ajoute des boutons cliquables par ligne.</li>
                    <li><a href="choice.html">Choice</a>: Sélection de valeurs prédéfinies (toggle/searchable).</li>
                    <li><a href="color.html">Color</a>: Sélecteur de couleur (nécessite ColorFlow).</li>
                    <li><a href="columnreorder.html">ColumnReorder</a>: Réorganisation des colonnes par drag & drop.</li>
                    <li><a href="contextmenu.html">ContextMenu</a>: Framework pour menu contextuel.</li>
                    <li><a href="edit.html">Edit</a>: Édition en ligne (double-clic) et système de hooks.</li>
                    <li><a href="filterandpaginate.html">Filter & Paginate</a>: Filtrage global et pagination côté client.</li>
                    <li><a href="highlight.html">Highlight</a>: Surlignage de texte basé sur règles regex.</li>
                    <li><a href="hide.html">Hide</a>: Masque des colonnes au chargement.</li>
                    <li><a href="linetoggle.html">LineToggle</a>: Change le style d'une ligne selon la valeur d'une cellule.</li>
                    <li><a href="selection.html">Selection</a>: Sélection avancée de cellules/lignes/colonnes.</li>
                    <li><a href="sort.html">Sort</a>: Tri des colonnes au clic sur l'en-tête.</li>
                    <li><a href="texteditor.html">TextEditor</a>: Actions d'édition de texte (extension Edit/ContextMenu).</li>
                    <li><a href="validation.html">Validation</a>: Validation des données avant sauvegarde (extension Edit).</li>
                    </ul>
            </section>

            <section id="exemples-complets">
                <h2>Exemples Complets</h2>
                <p>Ces exemples montrent comment combiner plusieurs plugins.</p>

                <article id="exemple-gestion-taches">
                    <h3>Exemple 1 : Tableau de Gestion de Tâches</h3>
                    <p>Combine Edit, Validation, Choice, LineToggle, Actions, ContextMenu, TextEditor, Sort, ColumnReorder, Hide.</p>
                    <div class="example">
                        <div class="example-preview">
                             <table id="exempleTableTaches">
                                 <thead>
                                      <tr>
                                          <th id="tacheId" th-hide>ID</th>
                                          <th id="tacheDesc" th-edit>Description</th>
                                          <th id="tacheStatut" th-choice th-linetoggle>Statut</th>
                                          <th id="tachePrio" th-choice="toggle" th-sort>Priorité</th>
                                          <th id="tacheEcheance" th-edit th-validate='{"date": {"maxDate": "2026-12-31"}}'>Échéance</th>
                                          <th id="tacheActions" th-actions="save,delete">Actions</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr id="task-1"> <td id="tacheId_task-1">1</td> <td id="tacheDesc_task-1">Finaliser rapport. @compta</td> <td id="tacheStatut_task-1" data-value="in_progress">En cours</td> <td id="tachePrio_task-1" data-value="Haute">Haute</td> <td id="tacheEcheance_task-1" data-value="2025-05-10">2025-05-10</td> <td id="tacheActions_task-1"></td> </tr>
                                      <tr id="task-2"> <td id="tacheId_task-2">2</td> <td id="tacheDesc_task-2">Préparer démo. TODO: slides.</td> <td id="tacheStatut_task-2" data-value="pending">En attente</td> <td id="tachePrio_task-2" data-value="Moyenne">Moyenne</td> <td id="tacheEcheance_task-2" data-value="2025-05-15">2025-05-15</td> <td id="tacheActions_task-2"></td> </tr>
                                      <tr id="task-3"> <td id="tacheId_task-3">3</td> <td id="tacheDesc_task-3">Corriger bug #456 (urgent).</td> <td id="tacheStatut_task-3" data-value="error">Erreur Bloquante</td> <td id="tachePrio_task-3" data-value="Haute">Haute</td> <td id="tacheEcheance_task-3" data-value=""></td> <td id="tacheActions_task-3"></td> </tr>
                                      <tr id="task-4"> <td id="tacheId_task-4">4</td> <td id="tacheDesc_task-4">Archivage projet Y.</td> <td id="tacheStatut_task-4" data-value="completed">Terminé</td> <td id="tachePrio_task-4" data-value="Basse">Basse</td> <td id="tacheEcheance_task-4" data-value="2025-04-30">2025-04-30</td> <td id="tacheActions_task-4"></td> </tr>
                                  </tbody>
                             </table>
                         </div>
                        <div class="example-code">
                            <pre><code class="language-javascript">// Initialisation TableFlow pour l'exemple de tâches
import TableFlow from '../src/tableFlow.js'; // Ajustez

const tachesTable = new TableFlow({
    tableId: 'exempleTableTaches',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: [
            'Hide', 'Edit', 'Validation', 'Choice', 'LineToggle',
            'Actions', 'ContextMenu', 'TextEditor', 'Sort', 'ColumnReorder'
        ],
        // Config spécifique des plugins (extraits)
        choice: {
            columns: {
                'tacheStatut': { type: 'searchable', values: [/*...*/], readOnlyValues: [/*...*/] },
                'tachePrio': { type: 'toggle', values: ['Basse', 'Moyenne', 'Haute'] }
            }
        },
        linetoggle: {
            rules: { 'tacheStatut': [/*...*/] }
        },
        actions: {
            actions: { /* ... handlers save/delete ... */ },
            icons: { /* ... icônes ... */ }
        },
        columnreorder: { excludeSelector: '[th-hide], [th-actions]' }
        // Autres plugins utilisent config par défaut ou attributs HTML
    }
});
// Ajouter des listeners ou interagir après initialisation
tachesTable.ready().then(instance => {
    console.log("Tableau des tâches prêt !");
    // instance.addRow({ tacheDesc: 'Nouvelle tâche', tacheStatut: 'pending', tachePrio: 'Moyenne' });
});
</code></pre>
                        </div>
                    </div>
                </article>

                <article id="exemple-catalogue-produits">
                     <h3>Exemple 2 : Catalogue Produits Interactif</h3>
                     <p>Combine Edit, Validation, Color, Highlight, Sort, FilterAndPaginate, ColumnReorder, ContextMenu.</p>
                     <div class="example">
                         <div class="example-preview">
                              <input type="text" id="filterProduits" placeholder="Filtrer les produits...">
                              <table id="exempleTableProduits">
                                  <thead>
                                       <tr>
                                           <th id="prodSku" th-sort>SKU</th>
                                           <th id="prodNom" th-edit th-sort>Nom du Produit</th>
                                           <th id="prodCouleur" th-color>Couleur</th>
                                           <th id="prodStock" th-edit th-validate='{"number": {"min":0, "integer":true}}'>Stock</th>
                                           <th id="prodTags" th-edit>Tags (urgent, promo)</th>
                                       </tr>
                                   </thead>
                                    <tbody>
                                       <tr id="prod-101"> <td id="prodSku_prod-101">ABC-001</td> <td id="prodNom_prod-101">Super Widget Bleu</td> <td id="prodCouleur_prod-101" data-value="#3b82f6">Bleu</td> <td id="prodStock_prod-101" data-value="50">50</td> <td id="prodTags_prod-101">nouveau, promo</td> </tr>
                                       <tr id="prod-102"> <td id="prodSku_prod-102">XYZ-002</td> <td id="prodNom_prod-102">Widget Rouge Standard</td> <td id="prodCouleur_prod-102" data-value="#ef4444">Rouge</td> <td id="prodStock_prod-102" data-value="0">0</td> <td id="prodTags_prod-102">standard, urgent</td> </tr>
                                        <tr id="prod-103"> <td id="prodSku_prod-103">DEF-003</td> <td id="prodNom_prod-103">Gadget Vert</td> <td id="prodCouleur_prod-103" data-value="#22c55e">Vert</td> <td id="prodStock_prod-103" data-value="120">120</td> <td id="prodTags_prod-103">best-seller</td> </tr>
                                        </tbody>
                              </table>
                              </div>
                         <div class="example-code">
                             <pre><code class="language-javascript">// Initialisation TableFlow pour l'exemple produits
import TableFlow from '../src/tableFlow.js'; // Ajustez

// Simulation ColorFlow si non disponible
if (typeof ColorFlow === 'undefined') { window.ColorFlow = class { setupInput(i){ const p=document.createElement('span'); p.className='tf-color-preview'; p.style.cssText='display:inline-block;width:20px;height:20px;border:1px solid #ccc;vertical-align:middle;margin-right:5px;cursor:pointer'; p.style.backgroundColor=i.value; p.onclick=()=>{i.value='#'+Math.floor(Math.random()*16777215).toString(16).padStart(6,'0').toUpperCase();i.dispatchEvent(new Event('change',{bubbles:true}));p.style.backgroundColor=i.value;}; i.parentNode.insertBefore(p,i); i.addEventListener('change',()=>p.style.backgroundColor=i.value);}}; console.warn("ColorFlow simulé."); }

const produitsTable = new TableFlow({
    tableId: 'exempleTableProduits',
    pluginsPath: '../plugins', // Ajustez
    debug: true,
    plugins: {
        names: [
            'Edit', 'Validation', 'Color', 'Highlight', 'Sort',
            'FilterAndPaginate', 'ColumnReorder', 'ContextMenu'
        ],
        highlight: { // Surligner 'urgent' et 'promo'
            groups: [
                { id: 'urgent', name: 'Urgent', color: 'red', backgroundColor: 'pink', priority: 0 },
                { id: 'promo', name: 'Promo', color: 'white', backgroundColor: 'green', priority: 1 }
            ],
            rules: [
                { group: 'urgent', regex: '\\burgent\\b' },
                { group: 'promo', regex: '\\bpromo\\b' }
            ],
            menuEnabled: true // Ajouter options au menu contextuel
        },
        filterandpaginate: {
            enableFilter: true,
            globalFilter: '#filterProduits', // ID de l'input de filtre
            pageSize: 2, // Petit pour la démo
            btnClass: 'tf-page-button', // Utiliser classe définie dans CSS
            selectClass: 'tf-pagesize-select'
        }
        // Autres plugins utilisent config par défaut ou attributs HTML
    }
});
</code></pre>
                         </div>
                     </div>
                </article>

            </section>

             <section id="personnalisation">
                <h2>Personnalisation</h2>
                <h3>Styles CSS</h3>
                <p>
                    L'apparence de la table et des éléments ajoutés par les plugins (indicateurs de tri, boutons d'action, sélecteurs de couleur, etc.) est contrôlée par CSS.
                </p>
                <p>
                    Le fichier `src/tableFlow.css` fournit des styles de base. Il est fortement recommandé de :
                </p>
                <ol>
                    <li><strong>Utiliser les Variables CSS :</strong> Le fichier `tableFlow.css` (version mise à jour) définit des variables CSS (ex: `--tf-primary-color`, `--tf-border-color`, `--tf-modified-bg`). Vous pouvez facilement surcharger ces variables dans votre propre feuille de style pour adapter l'apparence à votre thème sans modifier directement `tableFlow.css`.</li>
                    <li><strong>Surcharger les Classes :</strong> Vous pouvez cibler les classes CSS ajoutées par TableFlow et ses plugins (ex: `.td-actions`, `.sortable`, `.tf-page-button`, `.tf-color-wrapper`) dans votre CSS pour appliquer des styles plus spécifiques ou intégrer l'apparence à votre framework UI (Bootstrap, Tailwind, etc.).</li>
                    <li><strong>Configuration des Classes :</strong> De nombreux plugins permettent de configurer les classes CSS utilisées via leurs options JavaScript (ex: `plugins.actions.cellClass`, `plugins.filterandpaginate.btnClass`). Utilisez ces options pour aligner les classes avec votre système de design.</li>
                </ol>
                 <pre><code class="language-css">/* Exemple de personnalisation dans votre fichier CSS */
:root {
  --tf-primary-color: #dc3545; /* Thème Rouge */
  --tf-border-color: #dee2e6;
  --tf-header-bg: #f8f9fa;
  --tf-modified-bg: #ffeeba;
}

/* Surcharger le style des boutons de pagination */
.tf-page-button {
  /* Styles de vos boutons personnalisés */
  background-color: #6c757d;
  color: white;
  border: none;
  padding: 0.4rem 0.8rem;
}
.tf-page-button.active {
  background-color: var(--tf-primary-color);
}
.tf-page-button:disabled {
  background-color: #ced4da;
}

/* Personnaliser les cellules d'action */
table[data-tableflow-id] td.td-actions .cell-wrapper {
    justify-content: flex-end; /* Aligner à droite */
    gap: 12px;
}
</code></pre>

                <h3>Configuration JavaScript</h3>
                <p>
                    La configuration passée à `new TableFlow(...)` et spécifiquement l'objet `plugins` permet une personnalisation fine :
                </p>
                <ul>
                    <li>Activer/désactiver des plugins (`plugins.names`).</li>
                    <li>Configurer le comportement de chaque plugin (ex: `plugins.sort.ignoreCase`, `plugins.actions.showOnChange`).</li>
                    <li>Définir des listes d'options dynamiques (`plugins.choice.columns[id].values`).</li>
                    <li>Fournir des fonctions `handler` personnalisées pour les actions (`plugins.actions.actions[name].handler`).</li>
                    <li>Ajouter ou surcharger des validateurs (`plugins.validation.validators`).</li>
                    <li>Modifier les textes et icônes (`plugins.filterandpaginate.labels`, `plugins.actions.icons`).</li>
                </ul>

                <h3>Extension via Plugins</h3>
                <p>
                    Si les options existantes ne suffisent pas, vous pouvez créer vos propres plugins pour ajouter des fonctionnalités spécifiques ou modifier le comportement des plugins existants en utilisant le système de hooks (si exposé par le plugin cible, comme `Edit`) ou en interagissant avec l'API `TableInstance`.
                </p>
            </section>

            <section id="contribution">
                <h2>Contribution</h2>
                <p>
                    (Section à compléter si le projet est open source)
                    Informations sur la manière de rapporter des bugs, proposer des améliorations, ou contribuer au code. Liens vers le dépôt Git, guide de contribution, etc.
                </p>
            </section>

        </div> </div> <script type="module">
        // Script pour mettre à jour le lien actif dans la navigation latérale
        // en fonction de la section visible à l'écran.
        const updateNavActiveLink = () => {
            let currentSectionId = 'introduction'; // Défaut
            const sections = document.querySelectorAll('.content section[id], .content article[id]');
            const scrollPosition = window.scrollY || document.documentElement.scrollTop;
            const offset = 150; // Décalage pour la détection

            sections.forEach(section => {
                 // Vérifie si le haut de la section est visible ou dépassé
                 if (section.offsetTop <= scrollPosition + offset) {
                    currentSectionId = section.id;
                 }
            });

            const currentHash = '#' + currentSectionId;
            // Retirer 'active' de tous les liens
            document.querySelectorAll('.nav a.active').forEach(link => link.classList.remove('active'));

            // Trouver le lien direct ou le lien parent pour les exemples
            const directLink = document.querySelector(`.nav a[href$="${currentHash}"]`); // Utilise $= pour matcher la fin
             if(directLink) {
                 directLink.classList.add('active');
                 // Activer aussi le parent si c'est un sous-menu de plugin ou d'exemple
                 const parentUl = directLink.closest('ul');
                 const parentLi = parentUl?.parentElement; // Li contenant le sous-menu ul
                 if (parentLi && parentLi.tagName === 'LI' && parentLi.parentElement.classList.contains('nav')) {
                     // C'est un sous-menu, activer le lien parent
                     parentLi.querySelector('a')?.classList.add('active');
                 } else if (parentUl?.closest('li')?.parentElement?.closest('li')) {
                      // Encore un niveau plus haut (ex: lien d'exemple sous "Exemples Complets")
                      parentUl.closest('li').parentElement.closest('li').querySelector('a')?.classList.add('active');
                 }

             }
        };
        // Attacher les écouteurs
        window.addEventListener('load', updateNavActiveLink);
        window.addEventListener('scroll', updateNavActiveLink, { passive: true });
        window.addEventListener('hashchange', updateNavActiveLink);
        // Mettre à jour au clic pour une meilleure réactivité
        document.querySelectorAll('.nav a').forEach(link => {
            link.addEventListener('click', () => {
                // Léger délai pour laisser le scroll se faire avant de recalculer
                setTimeout(updateNavActiveLink, 100);
            });
        });
    </script>
</body>
</html>
