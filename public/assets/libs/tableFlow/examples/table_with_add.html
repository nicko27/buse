<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Table avec Ajout - nvTblHandler</title>
    <link rel="stylesheet" href="/assets/css/table-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="/assets/libs/nvTblHandler/nvTblHandler.js"></script>
    <style>
        .add-button {
            margin: 10px 0;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="block">
        <div class="block__title glass">
            <div class="block__title-left">
                Table avec Bouton d'Ajout
            </div>
        </div>

        <div class="block__content">
            <!-- Bouton d'ajout -->
            <button id="addRowBtn" class="add-button">
                <i class="fa fa-plus"></i> Ajouter une ligne
            </button>

            <table id="tableWithAdd">
                <thead>
                    <tr>
                        <th id="id" th-hide th-text-default="0">ID</th>
                        <th th-edit th-sort th-validate='{"required": true}' id="name">Nom</th>
                        <th th-edit th-validate='{"type": "email"}' id="email">Email</th>
                        <th th-choice id="status">Statut</th>
                        <th th-actions="delete,save">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="1">
                        <td>1</td>
                        <td>John Doe</td>
                        <td>john@example.com</td>
                        <td>active</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialisation de la table
            const table = new NvTblHandler({
                tableId: 'tableWithAdd',
                debug: true,
                plugins: {
                    names: ['Edit', 'Hide', 'Sort', 'Actions', 'Choice', 'Validate'],
                    choice: {
                        choiceAttribute: 'th-choice',
                        choices: {
                            'status': {
                                values: [
                                    { value: 'active', label: 'Actif' },
                                    { value: 'inactive', label: 'Inactif' }
                                ]
                            }
                        }
                    },
                    actions: {
                        actionAttribute: 'th-actions',
                        buttonClass: 'th-action-btn',
                        containerClass: 'th-actions',
                        useIcons: true,
                        actions: {
                            save: function(context) {
                                if (!context.tableHandler.isRowModified(context.row)) {
                                    alert('Aucune modification');
                                    return;
                                }
                                console.log('Saving:', context.data);
                                alert('Sauvegarde effectuée');
                                context.tableHandler.markRowAsSaved(context.row);
                            },
                            delete: function(context) {
                                if (confirm('Êtes-vous sûr de vouloir supprimer cette ligne ?')) {
                                    console.log('Deleting:', context.data);
                                    context.tableHandler.removeRow(context.row);
                                }
                            }
                        },
                        icons: {
                            delete: '<i class="fa fa-trash"></i>',
                            save: '<i class="fa fa-save"></i>'
                        }
                    }
                }
            });

            // Fonction pour générer un ID unique
            function generateUniqueId() {
                return Date.now().toString();
            }

            // Gestionnaire du bouton d'ajout
            document.getElementById('addRowBtn').addEventListener('click', function() {
                // Création d'une nouvelle ligne avec des valeurs par défaut
                const newRowData = {
                    id: generateUniqueId(),
                    name: '',
                    email: '',
                    status: 'active'
                };

                // Ajout de la ligne au tableau
                const newRow = table.addRow(newRowData);

                // Marquer la nouvelle ligne comme modifiée pour activer la sauvegarde
                table.markRowAsModified(newRow);

                // Optionnel : faire défiler jusqu'à la nouvelle ligne
                newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        });
    </script>
</body>
</html>
