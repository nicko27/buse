<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>nvTblHandler - Exemple Basique</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../src/nvTblHandler.js"></script>
</head>
<body>
    <!-- Documentation -->
    <div class="block mb-3">
        <div class="block__title">
            <div class="block__title-left">
                Documentation - Table Basique
            </div>
        </div>
        <div class="block__content">
            <h3>Fonctionnalités démontrées</h3>
            <ul>
                <li>Edition directe des cellules (plugin Edit)</li>
                <li>Tri des colonnes (plugin Sort)</li>
                <li>Validation des données (plugin Validate)</li>
                <li>Choix prédéfinis (plugin Choice)</li>
                <li>Actions basiques (plugin Actions)</li>
            </ul>

            <h3>Attributs HTML utilisés</h3>
            <ul>
                <li><code>th-edit</code> : Rend la colonne éditable</li>
                <li><code>th-sort</code> : Permet le tri sur la colonne</li>
                <li><code>th-validate</code> : Définit les règles de validation</li>
                <li><code>th-choice</code> : Configure les choix possibles</li>
                <li><code>th-actions</code> : Spécifie les actions disponibles</li>
            </ul>
        </div>
    </div>

    <!-- Table d'exemple -->
    <div class="block">
        <div class="block__title">
            <div class="block__title-left">
                Table Basique avec Édition
            </div>
        </div>

        <div class="block__content">
            <!-- Message de notification -->
            <div id="notification" style="display: none;" class="message"></div>

            <table id="basicTable">
                <thead>
                    <tr>
                        <th id="id" th-hide>ID</th>
                        <th th-edit th-sort th-validate='{"required": true, "minLength": 2}' id="name">
                            Nom
                            <i class="fa fa-info-circle" title="Minimum 2 caractères"></i>
                        </th>
                        <th th-edit th-validate='{"type": "email"}' id="email">
                            Email
                            <i class="fa fa-info-circle" title="Format email requis"></i>
                        </th>
                        <th th-choice id="status">Statut</th>
                        <th th-actions="delete,save">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="1">
                        <td>1</td>
                        <td>John Doe</td>
                        <td>john@example.com</td>
                        <td>active</td>
                        <td></td>
                    </tr>
                    <tr id="2">
                        <td>2</td>
                        <td>Jane Smith</td>
                        <td>jane@example.com</td>
                        <td>inactive</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <!-- Bouton d'ajout -->
            <button id="addRowBtn" class="button button-primary mt-3">
                <i class="fa fa-plus"></i> Ajouter une ligne
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fonction pour afficher les notifications
            function showNotification(message, type) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `message message-${type}`;
                notification.style.display = 'block';
                setTimeout(() => notification.style.display = 'none', 3000);
            }

            // Initialisation de la table
            const table = new NvTblHandler({
                tableId: 'basicTable',
                debug: true,
                plugins: {
                    names: ['Edit', 'Hide', 'Sort', 'Actions', 'Choice', 'Validate'],
                    choice: {
                        choiceAttribute: 'th-choice',
                        choices: {
                            'status': {
                                values: [
                                    { value: 'active', label: 'Actif' },
                                    { value: 'inactive', label: 'Inactif' }
                                ]
                            }
                        }
                    },
                    actions: {
                        actionAttribute: 'th-actions',
                        buttonClass: 'action-button',
                        containerClass: 'action-buttons',
                        useIcons: true,
                        actions: {
                            save: function(context) {
                                if (!context.tableHandler.isRowModified(context.row)) {
                                    showNotification('Aucune modification effectuée', 'error');
                                    return;
                                }
                                // Simulation d'une sauvegarde
                                setTimeout(() => {
                                    console.log('Saving:', context.data);
                                    showNotification('Données sauvegardées avec succès', 'success');
                                    context.tableHandler.markRowAsSaved(context.row);
                                }, 500);
                            },
                            delete: function(context) {
                                if (confirm('Êtes-vous sûr de vouloir supprimer cette ligne ?')) {
                                    // Simulation d'une suppression
                                    setTimeout(() => {
                                        console.log('Deleting:', context.data);
                                        context.tableHandler.removeRow(context.row);
                                        showNotification('Ligne supprimée avec succès', 'success');
                                    }, 500);
                                }
                            }
                        },
                        icons: {
                            delete: '<i class="fa fa-trash"></i>',
                            save: '<i class="fa fa-save"></i>'
                        },
                        labels: {
                            delete: 'Supprimer',
                            save: 'Sauvegarder'
                        }
                    },
                    validate: {
                        showErrors: true,
                        errorClass: 'message-error'
                    }
                }
            });

            // Gestionnaire du bouton d'ajout
            document.getElementById('addRowBtn').addEventListener('click', function() {
                const newId = table.tbody.children.length + 1;
                const newRowData = {
                    id: newId,
                    name: '',
                    email: '',
                    status: 'active'
                };

                const newRow = table.addRow(newRowData);
                table.markRowAsModified(newRow);
                newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                showNotification('Nouvelle ligne ajoutée', 'success');
            });
        });
    </script>
</body>
</html>
