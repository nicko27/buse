<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>nvTblHandler - Exemple Avancé</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../src/nvTblHandler.js"></script>
</head>
<body>
    <!-- Documentation -->
    <div class="block mb-3">
        <div class="block__title">
            <div class="block__title-left">
                Documentation - Table Avancée
            </div>
        </div>
        <div class="block__content">
            <h3>Fonctionnalités avancées</h3>
            <ul>
                <li>Pagination avec contrôle du nombre d'éléments par page</li>
                <li>Filtres globaux et par colonne</li>
                <li>Choix multiples avec validation</li>
                <li>Validation personnalisée</li>
                <li>Actions avec confirmation et retour visuel</li>
                <li>Persistance des données modifiées</li>
            </ul>

            <h3>Configuration des plugins</h3>
            <pre><code>
plugins: {
    names: ['Edit', 'Hide', 'Sort', 'Actions', 'Choice', 'Validate', 'Filter', 'Pagination'],
    pagination: {
        controlsId: 'pagination-controls',
        itemsPerPage: 5,
        showItemsPerPage: true
    },
    filter: {
        globalFilter: '#search-input',
        columnFilters: { ... }
    }
}
            </code></pre>
        </div>
    </div>

    <!-- Table d'exemple -->
    <div class="block">
        <div class="block__title">
            <div class="block__title-left">
                Table Avancée avec Filtres et Pagination
            </div>
        </div>

        <div class="block__content">
            <!-- Contrôles de filtrage -->
            <div class="filter-group">
                <input type="text" id="name-filter" placeholder="Filtrer par nom..." class="input">
                <input type="text" id="search-input" placeholder="Recherche globale..." class="input">
                <button id="search-reset" class="button button-primary">
                    <i class="fa fa-refresh"></i> Réinitialiser
                </button>
            </div>

            <!-- Contrôles de pagination -->
            <div id="pagination-controls" class="pagination"></div>

            <!-- Message de notification -->
            <div id="notification" style="display: none;" class="message"></div>

            <table id="advancedTable">
                <thead>
                    <tr>
                        <th id="id" th-hide>ID</th>
                        <th th-edit th-sort th-validate='{"required": true}' id="name">Nom</th>
                        <th th-edit th-validate='{"type": "email"}' id="email">Email</th>
                        <th th-choice id="role">Rôle</th>
                        <th th-choice id="status">Statut</th>
                        <th th-edit th-validate='{"type": "number", "min": 0, "max": 100}' id="progress">Progression</th>
                        <th th-actions="delete,save">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="1">
                        <td>1</td>
                        <td>John Doe</td>
                        <td>john@example.com</td>
                        <td>admin</td>
                        <td>active</td>
                        <td>75</td>
                        <td></td>
                    </tr>
                    <tr id="2">
                        <td>2</td>
                        <td>Jane Smith</td>
                        <td>jane@example.com</td>
                        <td>user</td>
                        <td>inactive</td>
                        <td>30</td>
                        <td></td>
                    </tr>
                    <!-- Ajoutez plus de lignes pour tester la pagination -->
                </tbody>
            </table>

            <!-- Bouton d'ajout -->
            <button id="addRowBtn" class="button button-primary mt-3">
                <i class="fa fa-plus"></i> Ajouter une ligne
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fonction pour afficher les notifications
            function showNotification(message, type) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `message message-${type}`;
                notification.style.display = 'block';
                setTimeout(() => notification.style.display = 'none', 3000);
            }

            // Initialisation de la table
            const table = new NvTblHandler({
                tableId: 'advancedTable',
                debug: true,
                plugins: {
                    names: ['Edit', 'Hide', 'Sort', 'Actions', 'Choice', 'Validate', 'Filter', 'Pagination'],
                    pagination: {
                        controlsId: 'pagination-controls',
                        itemsPerPage: 5,
                        showItemsPerPage: true
                    },
                    filter: {
                        globalFilter: '#search-input',
                        columnFilters: {
                            'name': '#name-filter'
                        },
                        debounceTime: 300
                    },
                    choice: {
                        choiceAttribute: 'th-choice',
                        choices: {
                            'role': {
                                values: [
                                    { value: 'admin', label: 'Administrateur' },
                                    { value: 'user', label: 'Utilisateur' },
                                    { value: 'guest', label: 'Invité' }
                                ]
                            },
                            'status': {
                                values: [
                                    { value: 'active', label: 'Actif' },
                                    { value: 'inactive', label: 'Inactif' },
                                    { value: 'pending', label: 'En attente' }
                                ]
                            }
                        }
                    },
                    actions: {
                        actionAttribute: 'th-actions',
                        buttonClass: 'action-button',
                        containerClass: 'action-buttons',
                        useIcons: true,
                        actions: {
                            save: function(context) {
                                if (!context.tableHandler.isRowModified(context.row)) {
                                    showNotification('Aucune modification effectuée', 'error');
                                    return;
                                }
                                // Simulation d'une sauvegarde avec délai
                                setTimeout(() => {
                                    console.log('Saving:', context.data);
                                    showNotification('Données sauvegardées avec succès', 'success');
                                    context.tableHandler.markRowAsSaved(context.row);
                                }, 500);
                            },
                            delete: function(context) {
                                if (confirm('Êtes-vous sûr de vouloir supprimer cette ligne ?')) {
                                    // Simulation d'une suppression avec délai
                                    setTimeout(() => {
                                        console.log('Deleting:', context.data);
                                        context.tableHandler.removeRow(context.row);
                                        showNotification('Ligne supprimée avec succès', 'success');
                                    }, 500);
                                }
                            }
                        },
                        icons: {
                            delete: '<i class="fa fa-trash"></i>',
                            save: '<i class="fa fa-save"></i>'
                        },
                        labels: {
                            delete: 'Supprimer',
                            save: 'Sauvegarder'
                        }
                    },
                    validate: {
                        showErrors: true,
                        errorClass: 'message-error'
                    }
                }
            });

            // Gestionnaire du bouton d'ajout
            document.getElementById('addRowBtn').addEventListener('click', function() {
                const newId = table.tbody.children.length + 1;
                const newRowData = {
                    id: newId,
                    name: '',
                    email: '',
                    role: 'user',
                    status: 'pending',
                    progress: '0'
                };

                const newRow = table.addRow(newRowData);
                table.markRowAsModified(newRow);
                newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                showNotification('Nouvelle ligne ajoutée', 'success');
            });

            // Gestionnaire du bouton de réinitialisation
            document.getElementById('search-reset').addEventListener('click', function() {
                document.getElementById('search-input').value = '';
                document.getElementById('name-filter').value = '';
                table.plugins.Filter.resetFilters();
                showNotification('Filtres réinitialisés', 'success');
            });
        });
    </script>
</body>
</html>
